"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?exports.WebIM=e():t.WebIM=e()}(void 0,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(module,exports,__webpack_require__){function _parsePrivacy(t){var e=[],n=t.getElementsByTagName("item");if(n)for(var r=0;r<n.length;r++){var i=n[r],o=i.getAttribute("value"),s=i.getAttribute("order"),a=i.getAttribute("type");if(o){var c=_parseNameFromJidFn(o);e[c]={type:a,order:s,jid:o,name:c}}}return e}function _parseGroupBlacklist(t){var e={},n=t.getElementsByTagName("item");if(n)for(var r=0;r<n.length;r++){var i=n[r],o=i.getAttribute("jid"),s=i.getAttribute("affiliation"),a=i.getAttribute("nick");if(o){var c=_parseNameFromJidFn(o);e[c]={jid:o,affiliation:s,nick:a,name:c}}}return e}function _setText(t,e){"textContent"in t?t.textContent=e:"text"in t&&(t.text=e)}function logMessage(t){WebIM&&WebIM.config.isDebug&&console.log(WebIM.utils.ts()+"[recv] ",t.data)}var _version="1.4.2",_code=__webpack_require__(2).code,_utils=__webpack_require__(3).utils,_msg=__webpack_require__(4),_message=_msg._msg,_msgHash={},Queue=__webpack_require__(39).Queue,CryptoJS=__webpack_require__(5),Strophe=__webpack_require__(40).Strophe,_=__webpack_require__(41),stropheConn=null;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.XDomainRequest,Strophe.Request.prototype._newXHR=function(){var t=_utils.xmlrequest(!0);return t.overrideMimeType&&t.overrideMimeType("text/xml"),t.onreadystatechange=this.func.bind(null,this),t},Strophe.Websocket.prototype._closeSocket=function(){if(this.socket){var t=this;setTimeout(function(){try{t.socket.close()}catch(t){}},0)}else this.socket=null},Strophe.Websocket.prototype._onMessage=function(t){logMessage(t);var e=t.data;if(e.indexOf("<jid>")>0){var n=e.indexOf("<jid>"),r=e.indexOf("</jid>"),e=e.substring(n+5,r);stropheConn.jid=e,stropheConn.authzid=Strophe.getBareJidFromJid(stropheConn.jid),stropheConn.authcid=Strophe.getNodeFromJid(stropheConn.jid)}var i,e;if(0===t.data.indexOf("<close ")){i=(new DOMParser).parseFromString(t.data,"text/xml").documentElement;var o=i.getAttribute("see-other-uri");return void(o?(this._conn._changeConnectStatus(Strophe.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=o,this._connect()):this._conn._doDisconnect("receive <close> from server"))}if(0===t.data.search("<open ")){if(i=(new DOMParser).parseFromString(t.data,"text/xml").documentElement,!this._handleStreamStart(i))return}else e=this._streamWrap(t.data),i=(new DOMParser).parseFromString(e,"text/xml").documentElement;if(!this._check_streamerror(i,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===i.firstChild.nodeName&&"unavailable"===i.firstChild.getAttribute("type")?(this._conn.xmlInput(i),void this._conn.rawInput(Strophe.serialize(i))):void this._conn._dataRecv(i,t.data)};var _listenNetwork=function(t,e){window.addEventListener?(window.addEventListener("online",t),window.addEventListener("offline",e)):window.attachEvent&&(document.body?(document.body.attachEvent("ononline",t),document.body.attachEvent("onoffline",e)):window.attachEvent("load",function(){document.body.attachEvent("ononline",t),document.body.attachEvent("onoffline",e)}))},_parseRoom=function(t){var e=[],n=t.getElementsByTagName("item");if(n)for(var r=0;r<n.length;r++){var i=n[r],o=i.getAttribute("jid"),s=o.split("@")[0],a={jid:o,name:i.getAttribute("name"),roomId:s.split("_")[1]};e.push(a)}return e},_parseRoomOccupants=function(t){var e=[],n=t.getElementsByTagName("item");if(n)for(var r=0;r<n.length;r++){var i=n[r],o={jid:i.getAttribute("jid"),name:i.getAttribute("name")};e.push(o)}return e},_parseResponseMessage=function _parseResponseMessage(msginfo){var parseMsgData={errorMsg:!0,data:[]},msgBodies=msginfo.getElementsByTagName("body");if(msgBodies){for(var i=0;i<msgBodies.length;i++){var msgBody=msgBodies[i],childNodes=msgBody.childNodes;if(childNodes&&childNodes.length>0){var childNode=msgBody.childNodes[0];if(childNode.nodeType==Strophe.ElementType.TEXT){var jsondata=childNode.wholeText||childNode.nodeValue;jsondata=jsondata.replace("\n","<br>");try{var data=eval("("+jsondata+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(t){}}}}var delayTags=msginfo.getElementsByTagName("delay");if(delayTags&&delayTags.length>0){var delayTag=delayTags[0],delayMsgTime=delayTag.getAttribute("stamp");delayMsgTime&&(parseMsgData.delayTimeStamp=delayMsgTime)}}else{var childrens=msginfo.childNodes;if(childrens&&childrens.length>0){var child=msginfo.childNodes[0];if(child.nodeType==Strophe.ElementType.TEXT)try{var data=eval("("+child.nodeValue+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(t){}}}return parseMsgData},_parseNameFromJidFn=function(t,e){e=e||"";var n=t,r=n.indexOf("_");-1!==r&&(n=n.substring(r+1));var i=n.indexOf("@"+e);return-1!==i&&(n=n.substring(0,i)),n},_parseFriend=function(t,e,n){var r=[],i=t.getElementsByTagName("item");if(i)for(var o=0;o<i.length;o++){var s=i[o],a=s.getAttribute("jid");if(a){var c=s.getAttribute("subscription"),u={subscription:c,jid:a},l=s.getAttribute("ask");l&&(u.ask=l);var h=s.getAttribute("name");if(h)u.name=h;else{var d=_parseNameFromJidFn(a);u.name=d}var p=[];Strophe.forEachChild(s,"group",function(t){p.push(Strophe.getText(t))}),u.groups=p,r.push(u),e&&"from"==c&&!l&&e.subscribe({toJid:a,message:"[resp:true]"}),e&&"to"==c&&e.subscribed({toJid:a})}}return r},_login=function(t,e){var n=t.access_token||"";if(""==n){_utils.stringify(t);return void e.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:t})}e.context.accessToken=t.access_token,e.context.accessTokenExpires=t.expires_in,stropheConn=e.isOpening()&&e.context.stropheConn?e.context.stropheConn:(e.isOpened()&&e.context.stropheConn,e.getStrophe());var r=function(t,n){_loginCallback(t,n,e)};e.context.stropheConn=stropheConn,e.route?stropheConn.connect(e.context.jid,"$t$"+n,r,e.wait,e.hold,e.route):stropheConn.connect(e.context.jid,"$t$"+n,r,e.wait,e.hold)},_parseMessageType=function(t){var e=t.getElementsByTagName("received"),n=t.getElementsByTagName("invite"),r=t.getElementsByTagName("delivery"),i=t.getElementsByTagName("acked"),o=t.getElementsByTagName("error"),s="normal";if(e&&e.length>0&&"urn:xmpp:receipts"===e[0].namespaceURI)s="received";else if(n&&n.length>0)s="invite";else if(r&&r.length>0)s="delivery";else if(i&&i.length)s="acked";else if(o&&o.length){var a=o[0],c=a.getElementsByTagName("user-muted");c&&c.length&&(s="userMuted")}return s},_handleMessageQueue=function(t){for(var e in _msgHash)_msgHash.hasOwnProperty(e)&&_msgHash[e].send(t)},_loginCallback=function(t,e,n){var r,i;if("conflict"===e&&(r=!0,n.close()),t==Strophe.Status.CONNFAIL)i={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:e,reconnect:!0},r&&(i.conflict=!0),n.onError(i);else if(t==Strophe.Status.ATTACHED||t==Strophe.Status.CONNECTED){n.autoReconnectNumTotal=0,n.intervalId=setInterval(function(){n.handelSendQueue()},200);var o=function(t){var e=t.getElementsByTagName("delivery"),r=t.getElementsByTagName("acked");if(e.length)return n.handleDeliveredMessage(t),!0;if(r.length)return n.handleAckedMessage(t),!0;switch(_parseMessageType(t)){case"received":return n.handleReceivedMessage(t),!0;case"invite":return n.handleInviteMessage(t),!0;case"delivery":return n.handleDeliveredMessage(t),!0;case"acked":return n.handleAckedMessage(t),!0;case"userMuted":return n.handleMutedMessage(t),!0;default:return n.handleMessage(t),!0}},s=function(t){return n.handlePresence(t),!0},a=function(t){return n.handlePing(t),!0},c=function(t){return n.handleIqRoster(t),!0},u=function(t){return n.handleIqPrivacy(t),!0},l=function(t){return n.handleIq(t),!0};n.addHandler(o,null,"message",null,null,null),n.addHandler(s,null,"presence",null,null,null),n.addHandler(a,"urn:xmpp:ping","iq","get",null,null),n.addHandler(c,"jabber:iq:roster","iq","set",null,null),n.addHandler(u,"jabber:iq:privacy","iq","set",null,null),n.addHandler(l,null,"iq",null,null,null),n.registerConfrIQHandler&&n.registerConfrIQHandler(),n.context.status=_code.STATUS_OPENED;var h=[_code.WEBIM_MESSAGE_REC_TEXT,_code.WEBIM_MESSAGE_REC_EMOJI];_utils.isCanDownLoadFile&&(h.push(_code.WEBIM_MESSAGE_REC_PHOTO),h.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE));var d=[_code.WEBIM_MESSAGE_SED_TEXT];_utils.isCanUploadFile&&(d.push(_code.WEBIM_MESSAGE_REC_PHOTO),d.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)),n.notifyVersion(),n.retry&&_handleMessageQueue(n),n.heartBeat(),n.isAutoLogin&&n.setPresence();try{if(n.unSendMsgArr.length>0)for(var p in n.unSendMsgArr){var f=n.unSendMsgArr[p];n.sendCommand(f),delete n.unSendMsgArr[p]}}catch(t){console.error(t.message)}n.offLineSendConnecting=!1,n.logOut=!1,n.onOpened({canReceive:h,canSend:d,accessToken:n.context.accessToken})}else if(t==Strophe.Status.DISCONNECTING)n.isOpened()&&(n.stopHeartBeat(),n.context.status=_code.STATUS_CLOSING,i={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:e,reconnect:!0},r&&(i.conflict=!0),n.onError(i));else if(t==Strophe.Status.DISCONNECTED){if(n.isOpened()){if(n.autoReconnectNumTotal<n.autoReconnectNumMax)return void n.reconnect();i={type:_code.WEBIM_CONNCTION_DISCONNECTED},n.onError(i)}n.context.status=_code.STATUS_CLOSED,n.clear(),n.onClosed()}else t==Strophe.Status.AUTHFAIL?(i={type:_code.WEBIM_CONNCTION_AUTH_ERROR},r&&(i.conflict=!0),n.onError(i),n.clear()):t==Strophe.Status.ERROR&&(n.context.status=_code.STATUS_ERROR,i={type:_code.WEBIM_CONNCTION_SERVER_ERROR},r&&(i.conflict=!0),n.onError(i));n.context.status_now=t},_getJid=function(t,e){var n=t.toJid||"";if(""===n){var r=e.context.appKey||"",i=r+"_"+t.to+"@"+e.domain;t.resource&&(i=i+"/"+t.resource),n=i}return n},_getJidByName=function(t,e){return _getJid({to:t},e)},_validCheck=function(t,e){if(t=t||{},""==t.user)return e.onError({type:_code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR}),!1;var n=t.user+""||"",r=t.appKey||"",i=r.split("#");if(2!==i.length)return e.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var o=i[0],s=i[1];if(!o)return e.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;if(!s)return e.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=r+"_"+n.toLowerCase()+"@"+e.domain,c=t.resource||"webim";return e.isMultiLoginSessions&&(c+=n+(new Date).getTime()+Math.floor(1e6*Math.random().toFixed(6))),e.context.jid=a+"/"+c,e.context.userId=n,e.context.appKey=r,e.context.appName=s,e.context.orgName=o,!0},_getXmppUrl=function(t,e){if(/^(ws|http)s?:\/\/?/.test(t))return t;var n={prefix:"http",base:"://"+t,suffix:"/http-bind/"};return e&&_utils.isSupportWss?(n.prefix="wss",n.suffix="/ws/"):e?n.prefix="https":window.WebSocket&&(n.prefix="ws",n.suffix="/ws/"),n.prefix+n.base+n.suffix},connection=function t(e){if(!this instanceof t)return new t(e);var e=e||{};this.isHttpDNS=e.isHttpDNS||!1,this.isMultiLoginSessions=e.isMultiLoginSessions||!1,this.wait=e.wait||30,this.hold=e.hold||1,this.retry=e.retry||!1,this.https=e.https||"https:"===location.protocol,this.url=_getXmppUrl(e.url,this.https),this.route=e.route||null,this.domain=e.domain||"easemob.com",this.inactivity=e.inactivity||30,this.heartBeatWait=e.heartBeatWait||4500,this.maxRetries=e.maxRetries||5,this.isAutoLogin=!1!==e.isAutoLogin,this.pollingTime=e.pollingTime||800,this.stropheConn=!1,this.autoReconnectNumMax=e.autoReconnectNumMax||0,this.autoReconnectNumTotal=0,this.autoReconnectInterval=e.autoReconnectInterval||0,this.context={status:_code.STATUS_INIT},this.sendQueue=new Queue,this.intervalId=null,this.apiUrl=e.apiUrl||"",this.isWindowSDK=e.isWindowSDK||!1,this.encrypt=e.encrypt||{encrypt:{type:"none"}},this.delivery=e.delivery||!1,this.user="",this.orgName="",this.appName="",this.token="",this.unSendMsgArr=[],this.offLineSendConnecting=!1,this.logOut=!1,this.dnsArr=["https://rs.easemob.com","https://rsbak.easemob.com","http://182.92.174.78","http://112.126.66.111"],this.dnsIndex=0,this.dnsTotal=this.dnsArr.length,this.restHosts=null,this.restIndex=0,this.restTotal=0,this.xmppHosts=null,this.xmppIndex=0,this.xmppTotal=0,this.groupOption={}};connection.prototype.testInit=function(t){this.orgName=t.orgName,this.appName=t.appName,this.user=t.user,this.token=t.token},connection.prototype.registerUser=function(t){"https:"!=location.protocol&&this.isHttpDNS?(this.dnsIndex=0,this.getHttpDNS(t,"signup")):this.signup(t)},connection.prototype.handelSendQueue=function(){var t=this.sendQueue.pop();null!==t&&this.sendReceiptsMessage(t)},connection.prototype.listen=function(t){this.onOpened=t.onOpened||_utils.emptyfn,this.onClosed=t.onClosed||_utils.emptyfn,this.onTextMessage=t.onTextMessage||_utils.emptyfn,this.onEmojiMessage=t.onEmojiMessage||_utils.emptyfn,this.onPictureMessage=t.onPictureMessage||_utils.emptyfn,this.onAudioMessage=t.onAudioMessage||_utils.emptyfn,this.onVideoMessage=t.onVideoMessage||_utils.emptyfn,this.onFileMessage=t.onFileMessage||_utils.emptyfn,this.onLocationMessage=t.onLocationMessage||_utils.emptyfn,this.onCmdMessage=t.onCmdMessage||_utils.emptyfn,this.onPresence=t.onPresence||_utils.emptyfn,this.onRoster=t.onRoster||_utils.emptyfn,this.onError=t.onError||_utils.emptyfn,this.onReceivedMessage=t.onReceivedMessage||_utils.emptyfn,this.onInviteMessage=t.onInviteMessage||_utils.emptyfn,this.onDeliverdMessage=t.onDeliveredMessage||_utils.emptyfn,this.onReadMessage=t.onReadMessage||_utils.emptyfn,this.onMutedMessage=t.onMutedMessage||_utils.emptyfn,this.onOffline=t.onOffline||_utils.emptyfn,this.onOnline=t.onOnline||_utils.emptyfn,this.onConfirmPop=t.onConfirmPop||_utils.emptyfn,this.onCreateGroup=t.onCreateGroup||_utils.emptyfn,this.onUpdateMyGroupList=t.onUpdateMyGroupList||_utils.emptyfn,this.onUpdateMyRoster=t.onUpdateMyRoster||_utils.emptyfn,this.onBlacklistUpdate=t.onBlacklistUpdate||_utils.emptyfn,_listenNetwork(this.onOnline,this.onOffline)},connection.prototype.heartBeat=function(t){!0!==t&&(t=!1);var e=this,n=!/^ws|wss/.test(e.url)||/mobile/.test(navigator.userAgent);if(!this.heartBeatID&&(t||n)){var r={toJid:this.domain,type:"normal"};this.heartBeatID=setInterval(function(){_utils.isSupportWss&&e.ping(r)},this.heartBeatWait)}},connection.prototype.stopHeartBeat=function(){"number"==typeof this.heartBeatID&&(this.heartBeatID=clearInterval(this.heartBeatID))},connection.prototype.sendReceiptsMessage=function(t){var e=$msg({from:this.context.jid||"",to:this.domain,id:t.id||""}).c("received",{xmlns:"urn:xmpp:receipts",id:t.id||""});this.sendCommand(e.tree())},connection.prototype.cacheReceiptsMessage=function(t){this.sendQueue.push(t)},connection.prototype.getStrophe=function(){if("https:"!=location.protocol&&this.isHttpDNS){var t="",e=this.xmppHosts[this.xmppIndex],n=_utils.getXmlFirstChild(e,"domain"),r=_utils.getXmlFirstChild(e,"ip");if(r){t=r.textContent;var i=_utils.getXmlFirstChild(e,"port");"80"!=i.textContent&&(t+=":"+i.textContent)}else t=n.textContent;if(""!=t){var o=/(.+\/\/).+(\/.+)/;this.url=this.url.replace(o,"$1"+t+"$2")}}return new Strophe.Connection(this.url,{inactivity:this.inactivity,maxRetries:this.maxRetries,pollingTime:this.pollingTime})},connection.prototype.getHostsByTag=function(t,e){var n=_utils.getXmlFirstChild(t,e);if(!n)return console.log(e+" hosts error"),null;var r=n.getElementsByTagName("hosts");return 0==r.length?(console.log(e+" hosts error2"),null):r[0].getElementsByTagName("host")},connection.prototype.getRestFromHttpDNS=function(t,e){if(this.restIndex>this.restTotal)return void console.log("rest hosts all tried,quit");var n="",r=this.restHosts[this.restIndex],i=_utils.getXmlFirstChild(r,"domain"),o=_utils.getXmlFirstChild(r,"ip");if(o){var s=_utils.getXmlFirstChild(r,"port");n=("https:"===location.protocol?"https:":"http:")+"//"+o.textContent+":"+s.textContent}else n=("https:"===location.protocol?"https:":"http:")+"//"+i.textContent;""!=n&&(this.apiUrl=n,t.apiUrl=n),"login"==e?this.login(t):this.signup(t)},connection.prototype.getHttpDNS=function(t,e){if(this.restHosts)return void this.getRestFromHttpDNS(t,e);var n=this,r=function(r,i){r=(new DOMParser).parseFromString(r,"text/xml").documentElement;var o=n.getHostsByTag(r,"rest");if(!o)return void console.log("rest hosts error3");n.restHosts=o,n.restTotal=o.length;var s=n.getHostsByTag(r,"xmpp");if(!s)return void console.log("xmpp hosts error3");n.xmppHosts=s,n.xmppTotal=s.length,n.getRestFromHttpDNS(t,e)},i=function(r,i,o){console.log("getHttpDNS error",r,o),++n.dnsIndex<n.dnsTotal&&n.getHttpDNS(t,e)},o={url:this.dnsArr[this.dnsIndex]+"/easemob/server.xml",dataType:"text",type:"GET",data:{app_key:encodeURIComponent(t.appKey)},success:r||_utils.emptyfn,error:i||_utils.emptyfn};_utils.ajax(o)},connection.prototype.signup=function(t){var e=this,n=t.orgName||"",r=t.appName||"",i=t.appKey||"",o=t.success||EMPTYFN,s=t.error||EMPTYFN;if(!n&&!r&&i){var a=i.split("#");2===a.length&&(n=a[0],r=a[1])}if(!n&&!r)return void s({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR});var c=function(n,r,i){if("https:"!=location.protocol&&e.isHttpDNS&&e.restIndex+1<e.restTotal)return e.restIndex++,void e.getRestFromHttpDNS(t,"signup");e.clear(),s(n)},u=t.https||u,l=t.apiUrl,h=l+"/"+n+"/"+r+"/users",d={username:t.username,password:t.password,nickname:t.nickname||""},p=_utils.stringify(d),f={url:h,dataType:"json",data:p,success:o,error:c};_utils.ajax(f)},connection.prototype.open=function(t){var e=t.appKey,n=e.split("#")[0],r=e.split("#")[1];this.orgName=n,this.appName=r,t.accessToken&&(this.token=t.accessToken),t.xmppURL&&(this.url=_getXmppUrl(t.xmppURL,this.https)),"https:"!=location.protocol&&this.isHttpDNS?(this.dnsIndex=0,this.getHttpDNS(t,"login")):this.login(t)},connection.prototype.login=function(t){if(this.user=t.user,_validCheck(t,this)){var e=this;if(!e.isOpened())if(t.accessToken)t.access_token=t.accessToken,e.context.restTokenData=t,_login(t,e);else{var n=t.apiUrl,r=this.context.userId,i=t.pwd||"",o=this.context.appName,s=this.context.orgName,a=function(n,r){e.context.status=_code.STATUS_DOLOGIN_IM,e.context.restTokenData=n,t.success&&t.success(n),e.token=n.access_token,_login(n,e)},c=function(n,r,i){if(t.error&&t.error(),"https:"!=location.protocol&&e.isHttpDNS&&e.restIndex+1<e.restTotal)return e.restIndex++,void e.getRestFromHttpDNS(t,"login");e.clear(),n.error&&n.error_description?e.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:n,xhr:r}):e.onError({type:_code.WEBIM_CONNCTION_OPEN_ERROR,data:n,xhr:r})};this.context.status=_code.STATUS_DOLOGIN_USERGRID;var u={grant_type:"password",username:r,password:i,timestamp:+new Date},l=_utils.stringify(u),h={url:n+"/"+s+"/"+o+"/token",dataType:"json",data:l,success:a||_utils.emptyfn,error:c||_utils.emptyfn};_utils.ajax(h)}}},connection.prototype.attach=function(t){if(_validCheck(t,this)){t=t||{};var e=t.accessToken||"";if(""==e)return void this.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR});var n=t.sid||"";if(""===n)return void this.onError({type:_code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR});var r=t.rid||"";if(""===r)return void this.onError({type:_code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR});stropheConn=this.getStrophe(),this.context.accessToken=e,this.context.stropheConn=stropheConn,this.context.status=_code.STATUS_DOLOGIN_IM;var i=this,o=function(t,e){_loginCallback(t,e,i)},s=this.context.jid,a=this.wait,c=this.hold,u=this.wind||5;stropheConn.attach(s,n,r,o,a,c,u)}},connection.prototype.close=function(t){this.logOut=!0,this.stopHeartBeat(),this.context.status!=_code.STATUS_INIT&&(this.isClosed()||this.isClosing()||(this.context.status=_code.STATUS_CLOSING,this.context.stropheConn.disconnect(t)))},connection.prototype.addHandler=function(t,e,n,r,i,o,s){this.context.stropheConn.addHandler(t,e,n,r,i,o,s)},connection.prototype.notifyVersion=function(t,e){var n=stropheConn.jid;this.context.jid=n;var r=$iq({from:n||"",to:this.domain,type:"result"}).c("query",{xmlns:"jabber:iq:version"}).c("name").t("easemob").up().c("version").t(_version).up().c("os").t("webim"),t=t||_utils.emptyfn,i=e||this.onError,o=function(t){i({type:_code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR,data:t})};this.context.stropheConn.sendIQ(r.tree(),t,o)},connection.prototype.handlePresence=function(t){if(console.log("Info: ",void 0===t?"undefined":_typeof(t)),!this.isClosed()){var e=t.getAttribute("from")||"",n=t.getAttribute("to")||"",r=t.getAttribute("type")||"",i=t.getAttribute("presence_type")||"",o=_parseNameFromJidFn(e),s=_parseNameFromJidFn(n),a=!1,c=!1,u=!1,l=!1,h={from:o,to:s,fromJid:e,toJid:n,type:r,chatroom:!!t.getElementsByTagName("roomtype").length},d=t.getElementsByTagName("show");if(d&&d.length>0){var p=d[0];h.show=Strophe.getText(p)}var f=t.getElementsByTagName("status");if(f&&f.length>0){var _=f[0];h.status=Strophe.getText(_),h.code=_.getAttribute("code")}var m=t.getElementsByTagName("priority");if(m&&m.length>0){var g=m[0];h.priority=Strophe.getText(g)}var y=t.getElementsByTagName("error");if(y&&y.length>0){var y=y[0];h.error={code:y.getAttribute("code")}}var v=t.getElementsByTagName("destroy");if(v&&v.length>0){var v=v[0];h.destroy=!0;var b=v.getElementsByTagName("reason");b&&b.length>0&&(h.reason=Strophe.getText(b[0]))}var N=t.getElementsByTagName("item");if(N&&N.length>0){var E=N[0],S=E.getAttribute("role"),T=E.getAttribute("jid"),x=E.getAttribute("affiliation");if("none"==S&&T){var O=_parseNameFromJidFn(T),I=E.getElementsByTagName("actor")[0],C=I.getAttribute("nick");h.actor=C,h.kicked=O}"moderator"==S&&"201"==h.code&&"owner"===x&&(h.type="createGroupACK",a=!0)}var R=t.getElementsByTagName("x");if(R&&R.length>0){var A=R[0].getElementsByTagName("apply"),M=R[0].getElementsByTagName("accept"),w=R[0].getElementsByTagName("item"),B=R[0].getElementsByTagName("decline"),k=R[0].getElementsByTagName("add_admin"),D=R[0].getElementsByTagName("remove_admin"),j=R[0].getElementsByTagName("add_mute"),H=R[0].getElementsByTagName("remove_mute");if(A&&A.length>0){l=!0,h.toNick=A[0].getAttribute("toNick"),h.type="joinGroupNotifications";var L=A[0].getAttribute("to"),F=L.split("@")[0].split("_");F=F[F.length-1],h.gid=F}else if(M&&M.length>0)h.type="joinPublicGroupSuccess";else if(w&&w.length>0){var x=w[0].getAttribute("affiliation"),S=w[0].getAttribute("role");if("member"==x||"participant"==S){c=!0,h.mid=h.fromJid.split("/"),h.mid=h.mid[h.mid.length-1],h.type="memberJoinPublicGroupSuccess";var U=t.getElementsByTagName("roomtype");if(U&&U.length>0){var r=U[0].getAttribute("type");"chatroom"==r&&(h.type="memberJoinChatRoomSuccess")}}}else if(B&&B.length){u=!0;var F=B[0].getAttribute("fromNick"),W=_parseNameFromJidFn(B[0].getAttribute("from"));h.type="joinPublicGroupDeclined",h.owner=W,h.gid=F}else if(k&&k.length>0){var F=_parseNameFromJidFn(k[0].getAttribute("mucjid")),W=_parseNameFromJidFn(k[0].getAttribute("from"));h.owner=W,h.gid=F,h.type="addAdmin"}else if(D&&D.length>0){var F=_parseNameFromJidFn(D[0].getAttribute("mucjid")),W=_parseNameFromJidFn(D[0].getAttribute("from"));h.owner=W,h.gid=F,h.type="removeAdmin"}else if(j&&j.length>0){var F=_parseNameFromJidFn(j[0].getAttribute("mucjid")),W=_parseNameFromJidFn(j[0].getAttribute("from"));h.owner=W,h.gid=F,h.type="addMute"}else if(H&&H.length>0){var F=_parseNameFromJidFn(H[0].getAttribute("mucjid")),W=_parseNameFromJidFn(H[0].getAttribute("from"));h.owner=W,h.gid=F,h.type="removeMute"}}if(h.chatroom){h.presence_type=i,h.original_type=h.type;e.slice(e.lastIndexOf("/")+1)===this.context.userId&&(""!==h.type||h.code?"unavailable"!==i&&"unavailable"!==h.type||(h.status?110==h.code?h.type="leaveChatRoom":h.error&&406==h.error.code&&(h.type="reachChatRoomCapacity"):h.type="leaveChatRoom"):h.type="joinChatRoomSuccess")}else if(h.presence_type=i,h.original_type=r,/subscribe/.test(h.type));else if(""!=r||h.status||h.error||a||l||c||u){if("unavailable"===i||"unavailable"===r)if(h.destroy)h.type="deleteGroupChat";else if(307==h.code||321==h.code){var q=t.getAttribute("nick");h.type=q?"removedFromGroup":"leaveGroup"}}else console.log(2222222,t,h,l);this.onPresence(h,t)}},connection.prototype.handlePing=function(t){if(!this.isClosed()){var e=t.getAttribute("id"),n=t.getAttribute("from"),r=t.getAttribute("to"),i=$iq({from:r,to:n,id:e,type:"result"});this.sendCommand(i.tree())}},connection.prototype.handleIq=function(t){return!0},connection.prototype.handleIqPrivacy=function(t){0!=t.getElementsByTagName("list").length&&this.getBlacklist()},connection.prototype.handleIqRoster=function(t){var e=t.getAttribute("id"),n=t.getAttribute("from")||"",r=(_parseNameFromJidFn(n),this.context.jid),i=(this.context.userId,$iq({type:"result",id:e,from:r}));this.sendCommand(i.tree());var o=t.getElementsByTagName("query");if(o&&o.length>0){var s=o[0],a=_parseFriend(s,this,n);this.onRoster(a)}return!0},connection.prototype.handleMessage=function(t){var e=this;if(!this.isClosed()){var n=t.getAttribute("id")||"";this.cacheReceiptsMessage({id:n});var r=_parseResponseMessage(t);if(r.errorMsg)return void this.handlePresence(t);var i=t.getElementsByTagName("error"),o="",s="",a=!1;if(i.length>0){a=!0,o=i[0].getAttribute("code");var c=i[0].getElementsByTagName("text");s=c[0].textContent||c[0].text}var u=r.data;for(var l in u)if(u.hasOwnProperty(l)){var h=u[l];if(h.from&&h.to){var d=(h.from+"").toLowerCase(),p=(h.to+"").toLowerCase(),f=h.ext||{},_="",m=t.getElementsByTagName("roomtype");_=m.length?m[0].getAttribute("type")||"chat":t.getAttribute("type")||"chat";var g=h.bodies;if(g&&0!=g.length){var y=h.bodies[0],v=y.type;try{switch(v){case"txt":var b=y.msg;if("base64"===e.encrypt.type)b=atob(b);else if("aes"===e.encrypt.type){var N=CryptoJS.enc.Utf8.parse(e.encrypt.key),E=CryptoJS.enc.Utf8.parse(e.encrypt.iv),S=e.encrypt.mode.toLowerCase(),T={};"cbc"===S?T={iv:E,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}:"ebc"===S&&(T={mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});var x=b,O=CryptoJS.AES.decrypt(x,N,T),I=O.toString(CryptoJS.enc.Utf8);b=I}var C=_utils.parseTextMessage(b,WebIM.Emoji);if(C.isemoji){var h={id:n,type:_,from:d,to:p,delay:r.delayTimeStamp,data:C.body,ext:f};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=o,this.onEmojiMessage(h)}else{var h={id:n,type:_,from:d,to:p,delay:r.delayTimeStamp,data:b,ext:f};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=o,this.onTextMessage(h)}break;case"img":var R=0,A=0;y.size&&(R=y.size.width,A=y.size.height);var h={id:n,type:_,from:d,to:p,url:"https:"!=location.protocol&&e.isHttpDNS?e.apiUrl+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,thumb:y.thumb,thumb_secret:y.thumb_secret,file_length:y.file_length||"",width:R,height:A,filetype:y.filetype||"",accessToken:this.context.accessToken||"",ext:f,delay:r.delayTimeStamp};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=o,this.onPictureMessage(h);break;case"audio":var h={id:n,type:_,from:d,to:p,url:"https:"!=location.protocol&&e.isHttpDNS?e.apiUrl+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,length:y.length||"",file_length:y.file_length||"",filetype:y.filetype||"",accessToken:this.context.accessToken||"",ext:f,delay:r.delayTimeStamp};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=o,this.onAudioMessage(h);break;case"file":var h={id:n,type:_,from:d,to:p,url:"https:"!=location.protocol&&e.isHttpDNS?e.apiUrl+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,file_length:y.file_length,accessToken:this.context.accessToken||"",ext:f,delay:r.delayTimeStamp};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=o,this.onFileMessage(h);break;case"loc":var h={id:n,type:_,from:d,to:p,addr:y.addr,lat:y.lat,lng:y.lng,ext:f,delay:r.delayTimeStamp};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=o,this.onLocationMessage(h);break;case"video":var h={id:n,type:_,from:d,to:p,url:"https:"!=location.protocol&&e.isHttpDNS?e.apiUrl+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,file_length:y.file_length,accessToken:this.context.accessToken||"",ext:f,delay:r.delayTimeStamp};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=o,this.onVideoMessage(h);break;case"cmd":var h={id:n,from:d,to:p,action:y.action,ext:f,delay:r.delayTimeStamp};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=o,this.onCmdMessage(h)}if(e.delivery){var M=e.getUniqueId(),w=h.id,B=new WebIM.message("delivery",M);B.set({id:w,to:h.from}),e.send(B.body)}}catch(t){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:t})}}}}}},connection.prototype.handleDeliveredMessage=function(t){var e=t.id,n=t.getElementsByTagName("body"),r=0;r=isNaN(n[0].innerHTML)?n[1].innerHTML:n[0].innerHTML;var i={mid:r};this.onDeliverdMessage(i),this.sendReceiptsMessage({id:e})},connection.prototype.handleAckedMessage=function(t){var e=t.id,n=t.getElementsByTagName("body"),r=0;r=isNaN(n[0].innerHTML)?n[1].innerHTML:n[0].innerHTML;var i={mid:r};this.onReadMessage(i),this.sendReceiptsMessage({id:e})},connection.prototype.handleReceivedMessage=function(t){try{var e=t.getElementsByTagName("received"),n=e[0].getAttribute("mid"),r=t.getElementsByTagName("body"),i=r[0].innerHTML,o={mid:n,id:i};this.onReceivedMessage(o)}catch(t){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:t})}var i,n,s=t.getElementsByTagName("received");if(s.length>0&&(i=s[0].childNodes&&s[0].childNodes.length>0?s[0].childNodes[0].nodeValue:s[0].innerHTML||s[0].innerText,n=s[0].getAttribute("mid")),_msgHash[i]){try{_msgHash[i].msg.success instanceof Function&&_msgHash[i].msg.success(i,n)}catch(t){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:t})}delete _msgHash[i]}},connection.prototype.handleInviteMessage=function(t){var e=null,n=t.getElementsByTagName("invite"),r=t.getElementsByTagName("reason")[0],i=r.textContent,o=t.getAttribute("id")||"";if(this.sendReceiptsMessage({id:o}),n&&n.length>0){var s=n[0].getAttribute("from");e=_parseNameFromJidFn(s)}var a=t.getElementsByTagName("x"),c=null;if(a&&a.length>0)for(var u=0;u<a.length;u++)if("jabber:x:conference"===a[u].namespaceURI){var l=a[u].getAttribute("jid");c=_parseNameFromJidFn(l)}this.onInviteMessage({type:"invite",from:e,roomid:c,reason:i})},connection.prototype.handleMutedMessage=function(t){var e=t.id;this.onMutedMessage({mid:e})},connection.prototype.sendCommand=function(t,e){this.isOpened()?this.context.stropheConn.send(t):(this.unSendMsgArr.push(t),this.offLineSendConnecting||this.logOut||(this.offLineSendConnecting=!0,this.reconnect()),this.onError({type:_code.WEBIM_CONNCTION_DISCONNECTED,reconnect:!0}))},connection.prototype.getUniqueId=function(t){this.autoIncrement?this.autoIncrement++:this.autoIncrement=1;var e=new Date,n=new Date(2010,1,1),r=e.getTime()-n.getTime(),i=parseFloat(r).toString(16)+this.autoIncrement;return"string"==typeof t||"number"==typeof t?t+"_"+i:"WEBIM_"+i},connection.prototype.send=function(t){var e=this,n=t;if("txt"===n.type)if("base64"===this.encrypt.type)n=_.clone(t),n.msg=btoa(n.msg);else if("aes"===this.encrypt.type){n=_.clone(t);var r=CryptoJS.enc.Utf8.parse(this.encrypt.key),i=CryptoJS.enc.Utf8.parse(this.encrypt.iv),o=this.encrypt.mode.toLowerCase(),s={};"cbc"===o?s={iv:i,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}:"ebc"===o&&(s={mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});var a=CryptoJS.AES.encrypt(n.msg,r,s);n.msg=a.toString()}
if(this.isWindowSDK)WebIM.doQuery('{"type":"sendMessage","to":"'+n.to+'","message_type":"'+n.type+'","msg":"'+encodeURI(n.msg)+'","chatType":"'+n.chatType+'"}',function(t){},function(t,n){var r={data:{data:"send"},type:_code.WEBIM_MESSAGE_SED_ERROR};e.onError(r)});else if("[object Object]"===Object.prototype.toString.call(n)){var c=this.context.appKey||"",u=c+"_"+n.to+"@"+this.domain;n.group&&(u=c+"_"+n.to+"@conference."+this.domain),n.resource&&(u=u+"/"+n.resource),n.toJid=u,n.id=n.id||this.getUniqueId(),_msgHash[n.id]=new _message(n),_msgHash[n.id].send(this)}else"string"==typeof n&&_msgHash[n]&&_msgHash[n].send(this)},connection.prototype.addRoster=function(t){var e=_getJid(t,this),n=t.name||"",r=t.groups||"",i=$iq({type:"set"});if(i.c("query",{xmlns:"jabber:iq:roster"}),i.c("item",{jid:e,name:n}),r)for(var o=0;o<r.length;o++)i.c("group").t(r[o]).up();var s=t.success||_utils.emptyfn,a=t.error||_utils.emptyfn;this.context.stropheConn.sendIQ(i.tree(),s,a)},connection.prototype.removeRoster=function(t){var e=_getJid(t,this),n=$iq({type:"set"}).c("query",{xmlns:"jabber:iq:roster"}).c("item",{jid:e,subscription:"remove"}),r=t.success||_utils.emptyfn,i=t.error||_utils.emptyfn;this.context.stropheConn.sendIQ(n,r,i)},connection.prototype.getRoster=function(t){var e=$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"}),t=t||{},n=t.success||this.onRoster,r=function(t){var e=[],r=t.getElementsByTagName("query");if(r&&r.length>0){var i=r[0];e=_parseFriend(i)}n(e,t)},i=t.error||this.onError,o=function(t){i({type:_code.WEBIM_CONNCTION_GETROSTER_ERROR,data:t})};this.isOpened()?this.context.stropheConn.sendIQ(e.tree(),r,o):i({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.subscribe=function(t){var e=_getJid(t,this),n=$pres({to:e,type:"subscribe"});t.message&&n.c("status").t(t.message).up(),t.nick&&n.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(t.nick),this.sendCommand(n.tree())},connection.prototype.subscribed=function(t){var e=_getJid(t,this),n=$pres({to:e,type:"subscribed"});t.message&&n.c("status").t(t.message).up(),this.sendCommand(n.tree())},connection.prototype.unsubscribe=function(t){var e=_getJid(t,this),n=$pres({to:e,type:"unsubscribe"});t.message&&n.c("status").t(t.message),this.sendCommand(n.tree())},connection.prototype.unsubscribed=function(t){var e=_getJid(t,this),n=$pres({to:e,type:"unsubscribed"});t.message&&n.c("status").t(t.message).up(),this.sendCommand(n.tree())},connection.prototype.joinPublicGroup=function(t){var e=this.context.appKey+"_"+t.roomId+"@conference."+this.domain,n=e+"/"+this.context.userId,r=t.success||_utils.emptyfn,i=t.error||_utils.emptyfn,o=function(t){i({type:_code.WEBIM_CONNCTION_JOINROOM_ERROR,data:t})},s=$pres({from:this.context.jid,to:n}).c("x",{xmlns:Strophe.NS.MUC});this.context.stropheConn.sendIQ(s.tree(),r,o)},connection.prototype.listRooms=function(t){var e=$iq({to:t.server||"conference."+this.domain,from:this.context.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),n=t.success||_utils.emptyfn,r=t.error||this.onError,i=function(t){var e=[];e=_parseRoom(t);try{n(e)}catch(t){r({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:t})}},o=t.error||_utils.emptyfn,s=function(t){o({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:t})};this.context.stropheConn.sendIQ(e.tree(),i,s)},connection.prototype.queryRoomMember=function(t){var e=(this.domain,[]),n=$iq({to:this.context.appKey+"_"+t.roomId+"@conference."+this.domain,type:"get"}).c("query",{xmlns:Strophe.NS.MUC+"#admin"}).c("item",{affiliation:"member"}),r=t.success||_utils.emptyfn,i=function(t){var n=t.getElementsByTagName("item");if(n)for(var i=0;i<n.length;i++){var o=n[i],s={jid:o.getAttribute("jid"),affiliation:"member"};e.push(s)}r(e)},o=t.error||_utils.emptyfn,s=function(t){o({type:_code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR,data:t})};this.context.stropheConn.sendIQ(n.tree(),i,s)},connection.prototype.queryRoomInfo=function(t){var e=this.domain,n=$iq({to:this.context.appKey+"_"+t.roomId+"@conference."+e,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO}),r=t.success||_utils.emptyfn,i=[],o=function(t){var n="",o=t.getElementsByTagName("feature");switch(o&&(n=o[1].getAttribute("var")+"|"+o[3].getAttribute("var")+"|"+o[4].getAttribute("var")),n){case"muc_public|muc_membersonly|muc_notallowinvites":n="PUBLIC_JOIN_APPROVAL";break;case"muc_public|muc_open|muc_notallowinvites":n="PUBLIC_JOIN_OPEN";break;case"muc_hidden|muc_membersonly|muc_allowinvites":n="PRIVATE_MEMBER_INVITE";break;case"muc_hidden|muc_membersonly|muc_notallowinvites":n="PRIVATE_OWNER_INVITE"}var s=t.getElementsByTagName("field"),a={};if(s){for(var c=0;c<s.length;c++){var u=s[c],l=u.getAttribute("var"),h=l.split("_")[1];switch(l){case"muc#roominfo_occupants":case"muc#roominfo_maxusers":case"muc#roominfo_affiliations":case"muc#roominfo_description":a[h]=u.textContent||u.text||"";break;case"muc#roominfo_owner":var d={jid:(u.textContent||u.text)+"@"+e,affiliation:"owner"};i.push(d),a[h]=u.textContent||u.text}}a.name=t.getElementsByTagName("identity")[0].getAttribute("name")}r(n,i,a)},s=t.error||_utils.emptyfn,a=function(t){s({type:_code.WEBIM_CONNCTION_GETROOMINFO_ERROR,data:t})};this.context.stropheConn.sendIQ(n.tree(),o,a)},connection.prototype.queryRoomOccupants=function(t){var e=t.success||_utils.emptyfn,n=function(t){var n=[];n=_parseRoomOccupants(t),e(n)},r=t.error||_utils.emptyfn,i=function(t){r({type:_code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR,data:t})},o={xmlns:Strophe.NS.DISCO_ITEMS},s=$iq({from:this.context.jid,to:this.context.appKey+"_"+t.roomId+"@conference."+this.domain,type:"get"}).c("query",o);this.context.stropheConn.sendIQ(s.tree(),n,i)},connection.prototype.setUserSig=function(t){var e=$pres({xmlns:"jabber:client"});t=t||"",e.c("status").t(t),this.sendCommand(e.tree())},connection.prototype.setPresence=function(t,e){var n=$pres({xmlns:"jabber:client"});t&&(e?(n.c("show").t(t),n.up().c("status").t(e)):n.c("show").t(t)),this.sendCommand(n.tree())},connection.prototype.getPresence=function(){var t=$pres({xmlns:"jabber:client"});this.sendCommand(t.tree())},connection.prototype.ping=function(t){var t=t||{},e=_getJid(t,this),n=$iq({from:this.context.jid||"",to:e,type:"get"}).c("ping",{xmlns:"urn:xmpp:ping"}),r=t.success||_utils.emptyfn,i=t.error||this.onError,o=function(t){i({type:_code.WEBIM_CONNCTION_PING_ERROR,data:t})};this.isOpened()?this.context.stropheConn.sendIQ(n.tree(),r,o):i({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.isOpened=function(){return this.context.status==_code.STATUS_OPENED},connection.prototype.isOpening=function(){var t=this.context.status;return t==_code.STATUS_DOLOGIN_USERGRID||t==_code.STATUS_DOLOGIN_IM},connection.prototype.isClosing=function(){return this.context.status==_code.STATUS_CLOSING},connection.prototype.isClosed=function(){return this.context.status==_code.STATUS_CLOSED},connection.prototype.clear=function(){var t=this.context.appKey;if(this.errorType!=_code.WEBIM_CONNCTION_DISCONNECTED&&this.logOut&&(this.unSendMsgArr=[],this.offLineSendConnecting=!1,this.context={status:_code.STATUS_INIT,appKey:t}),this.intervalId&&clearInterval(this.intervalId),this.restIndex=0,this.xmppIndex=0,this.errorType==_code.WEBIM_CONNCTION_CLIENT_LOGOUT||-1==this.errorType){var e={data:{data:"logout"},type:_code.WEBIM_CONNCTION_CLIENT_LOGOUT};this.onError(e)}},connection.prototype.getChatRooms=function(t){var e=this,n=t.accessToken||this.context.accessToken;if(!_utils.isCanSetRequestHeader)return void e.onError({type:_code.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR});if(n){var r=t.apiUrl,i=this.context.appName,o=this.context.orgName;if(!i||!o)return void e.onError({type:_code.WEBIM_CONNCTION_AUTH_ERROR});var s=function(e,n){"function"==typeof t.success&&t.success(e)},a=function(t,n,r){t.error&&t.error_description&&e.onError({type:_code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,msg:t.error_description,data:t,xhr:n})},c={pagenum:parseInt(t.pagenum)||1,pagesize:parseInt(t.pagesize)||20},u={url:r+"/"+o+"/"+i+"/chatrooms",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+n},data:c,success:s||_utils.emptyfn,error:a||_utils.emptyfn};_utils.ajax(u)}else e.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR})},connection.prototype.joinChatRoom=function(t){var e=this.context.appKey+"_"+t.roomId+"@conference."+this.domain,n=e+"/"+this.context.userId,r=t.success||_utils.emptyfn,i=t.error||_utils.emptyfn,o=function(t){i({type:_code.WEBIM_CONNCTION_JOINCHATROOM_ERROR,data:t})},s=$pres({from:this.context.jid,to:n}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"member",role:"participant"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(s.tree(),r,o)},connection.prototype.quitChatRoom=function(t){var e=this.context.appKey+"_"+t.roomId+"@conference."+this.domain,n=e+"/"+this.context.userId,r=t.success||_utils.emptyfn,i=t.error||_utils.emptyfn,o=function(t){i({type:_code.WEBIM_CONNCTION_QUITCHATROOM_ERROR,data:t})},s=$pres({from:this.context.jid,to:n,type:"unavailable"}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"none",role:"none"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(s.tree(),r,o)},connection.prototype._onReceiveInviteFromGroup=function(info){info=eval("("+info+")");var self=this,options={title:"Group invitation",msg:info.user+" invites you to join into group:"+info.group_id,agree:function(){WebIM.doQuery('{"type":"acceptInvitationFromGroup","id":"'+info.group_id+'","user":"'+info.user+'"}',function(t){},function(t,e){var n={data:{data:"acceptInvitationFromGroup error:"+e},type:_code.WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP};self.onError(n)})},reject:function(){WebIM.doQuery('{"type":"declineInvitationFromGroup","id":"'+info.group_id+'","user":"'+info.user+'"}',function(t){},function(t,e){var n={data:{data:"declineInvitationFromGroup error:"+e},type:_code.WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP};self.onError(n)})}};this.onConfirmPop(options)},connection.prototype._onReceiveInviteAcceptionFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation response",msg:info.user+" agreed to join into group:"+info.group_id,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveInviteDeclineFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation response",msg:info.user+" rejected to join into group:"+info.group_id,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onAutoAcceptInvitationFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation",msg:"You had joined into the group:"+info.group_name+" automatically.Inviter:"+info.user,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onLeaveGroup=function(info){info=eval("("+info+")");var options={title:"Group notification",msg:"You have been out of the group:"+info.group_id+".Reason:"+info.msg,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveJoinGroupApplication=function(info){info=eval("("+info+")");var self=this,options={title:"Group join application",msg:info.user+" applys to join into group:"+info.group_id,agree:function(){WebIM.doQuery('{"type":"acceptJoinGroupApplication","id":"'+info.group_id+'","user":"'+info.user+'"}',function(t){},function(t,e){var n={data:{data:"acceptJoinGroupApplication error:"+e},type:_code.WEBIM_CONNECTION_ACCEPT_JOIN_GROUP};self.onError(n)})},reject:function(){WebIM.doQuery('{"type":"declineJoinGroupApplication","id":"'+info.group_id+'","user":"'+info.user+'"}',function(t){},function(t,e){var n={data:{data:"declineJoinGroupApplication error:"+e},type:_code.WEBIM_CONNECTION_DECLINE_JOIN_GROUP};self.onError(n)})}};this.onConfirmPop(options)},connection.prototype._onReceiveAcceptionFromGroup=function(info){info=eval("("+info+")");var options={title:"Group notification",msg:"You had joined into the group:"+info.group_name+".",agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveRejectionFromGroup=function(){info=eval("("+info+")");var options={title:"Group notification",msg:"You have been rejected to join into the group:"+info.group_name+".",agree:function(){}};this.onConfirmPop(options)},connection.prototype._onUpdateMyGroupList=function(t){this.onUpdateMyGroupList(t)},connection.prototype._onUpdateMyRoster=function(t){this.onUpdateMyRoster(t)},connection.prototype.reconnect=function(){var t=this;setTimeout(function(){_login(t.context.restTokenData,t)},1e3*(0==this.autoReconnectNumTotal?0:this.autoReconnectInterval)),this.autoReconnectNumTotal++},connection.prototype.closed=function(){var t={data:{data:"Closed error"},type:_code.WEBIM_CONNECTION_CLOSED};this.onError(t)},connection.prototype.getBlacklist=function(t){t=t||{};var e=$iq({type:"get"}),n=t.success||_utils.emptyfn,r=t.error||_utils.emptyfn,i=this;e.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),this.context.stropheConn.sendIQ(e.tree(),function(t){i.onBlacklistUpdate(_parsePrivacy(t)),n()},function(){i.onBlacklistUpdate([]),r()})},connection.prototype.addToBlackList=function(t){for(var e=$iq({type:"set"}),n=t.list||{},r=t.type||"jid",i=t.success||_utils.emptyfn,o=t.error||_utils.emptyfn,s=e.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),a=Object.keys(n),c=a.length,u=2,l=0;l<c;l++){var h=n[a[l]],r=h.type||"jid",d=h.jid;s=s.c("item",{action:"deny",order:u++,type:r,value:d}).c("message"),l!==c-1&&(s=s.up().up())}this.context.stropheConn.sendIQ(s.tree(),i,o)},connection.prototype.removeFromBlackList=function(t){for(var e=$iq({type:"set"}),n=t.list||{},r=t.success||_utils.emptyfn,i=t.error||_utils.emptyfn,o=e.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),s=Object.keys(n),a=s.length,c=0;c<a;c++){var u=n[s[c]],l=u.type||"jid",h=u.jid,d=u.order;o=o.c("item",{action:"deny",order:d,type:l,value:h}).c("message"),c!==a-1&&(o=o.up().up())}this.context.stropheConn.sendIQ(o.tree(),r,i)},connection.prototype._getGroupJid=function(t){return(this.context.appKey||"")+"_"+t+"@conference."+this.domain},connection.prototype.addToGroupBlackList=function(t){var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,r=_getJid(t,this),i=this._getGroupJid(t.roomId),o=$iq({type:"set",to:i});o.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"outcast",jid:r}),this.context.stropheConn.sendIQ(o.tree(),e,n)},connection.prototype.getGroupBlacklist=function(t){var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,r=this._getGroupJid(t.roomId),i=$iq({type:"get",to:r});i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"outcast"}),this.context.stropheConn.sendIQ(i.tree(),function(t){e(_parseGroupBlacklist(t))},function(){n()})},connection.prototype.removeGroupMemberFromBlacklist=function(t){var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,r=_getJid(t,this),i=this._getGroupJid(t.roomId),o=$iq({type:"set",to:i});o.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"none",jid:r}),this.context.stropheConn.sendIQ(o.tree(),function(t){e()},function(){n()})},connection.prototype.changeGroupSubject=function(t){var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,r=this._getGroupJid(t.roomId),i=$iq({type:"set",to:r});i.c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("x",{type:"submit",xmlns:"jabber:x:data"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up().c("field",{var:"muc#roomconfig_roomname"}).c("value").t(t.subject).up().up().c("field",{var:"muc#roomconfig_roomdesc"}).c("value").t(t.description),this.context.stropheConn.sendIQ(i.tree(),function(t){e()},function(){n()})},connection.prototype.destroyGroup=function(t){var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,r=this._getGroupJid(t.roomId),i=$iq({type:"set",to:r});i.c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("destroy").c("reason").t(t.reason||""),this.context.stropheConn.sendIQ(i.tree(),function(t){e()},function(){n()})},connection.prototype.leaveGroupBySelf=function(t){var e=this,n=t.success||_utils.emptyfn,r=t.error||_utils.emptyfn,i=_getJid(t,this),o=this._getGroupJid(t.roomId),s=$iq({type:"set",to:o});s.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"none",jid:i}),this.context.stropheConn.sendIQ(s.tree(),function(t){n(t);var r=$pres({type:"unavailable",to:o+"/"+e.context.userId});e.sendCommand(r.tree())},function(t){r(t)})},connection.prototype.leaveGroup=function(t){for(var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,r=t.list||[],i=this._getGroupJid(t.roomId),o=$iq({type:"set",to:i}),s=o.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}),a=Object.keys(r),c=a.length,u=0;u<c;u++){var l=r[a[u]],h=_getJidByName(l,this);s=s.c("item",{affiliation:"none",jid:h}).up().c("item",{role:"none",jid:h}).up()}this.context.stropheConn.sendIQ(o.tree(),function(t){e(t)},function(t){n(t)})},connection.prototype.addGroupMembers=function(t){for(var e=t.success||_utils.emptyfn,n=t.error||_utils.emptyfn,r=t.list||[],i=this._getGroupJid(t.roomId),o=$iq({type:"set",to:i}),s=o.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}),a=r.length,c=0;c<a;c++){var u=r[c],l=_getJidByName(u,this);s=s.c("item",{affiliation:"member",jid:l}).up();var h=$msg({to:i}).c("x",{xmlns:"http://jabber.org/protocol/muc#user"}).c("invite",{to:l}).c("reason").t(t.reason||"");this.sendCommand(h.tree())}this.context.stropheConn.sendIQ(o.tree(),function(t){e(t)},function(t){n(t)})},connection.prototype.acceptInviteFromGroup=function(t){t.success=function(){},this.addGroupMembers(t)},connection.prototype.rejectInviteFromGroup=function(t){},connection.prototype.createGroupAsync=function(t){var e=t.from,n=this,r=this._getGroupJid(e),i=(this.context.userId,this.groupOption),o=t.success||_utils.emptyfn,s=$iq({type:"get",to:r}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});n.context.stropheConn.sendIQ(s.tree(),function(t){if("setAttribute"in t){var s=t.getElementsByTagName("x")[0];s.setAttribute("type","submit")}else Strophe.forEachChild(t,"x",function(t){t.setAttribute("type","submit")});Strophe.info("step 5 ----------"),Strophe.forEachChild(s,"field",function(t){var e=t.getAttribute("var"),n=t.getElementsByTagName("value")[0];switch(Strophe.info(e),e){case"muc#roomconfig_maxusers":_setText(n,i.optionsMaxUsers||200);break;case"muc#roomconfig_roomname":_setText(n,i.subject||"");break;case"muc#roomconfig_roomdesc":_setText(n,i.description||"");break;case"muc#roomconfig_publicroom":_setText(n,+i.optionsPublic);break;case"muc#roomconfig_membersonly":_setText(n,+i.optionsMembersOnly);break;case"muc#roomconfig_moderatedroom":_setText(n,+i.optionsModerate);break;case"muc#roomconfig_persistentroom":_setText(n,1);break;case"muc#roomconfig_allowinvites":_setText(n,+i.optionsAllowInvites);break;case"muc#roomconfig_allowvisitornickchange":case"muc#roomconfig_allowvisitorstatus":case"allow_private_messages":_setText(n,0);break;case"allow_private_messages_from_visitors":_setText(n,"nobody")}});var a=$iq({to:r,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).cnode(s);n.context.stropheConn.sendIQ(a.tree(),function(t){n.addGroupMembers({list:i.members,roomId:e}),o(i)},function(t){})},function(t){})},connection.prototype.createGroup=function(t){this.groupOption=t;var e=+new Date,n=this._getGroupJid(e),r=n+"/"+this.context.userId,i=$pres({to:r}).c("x",{xmlns:"http://jabber.org/protocol/muc"}).up().c("create",{xmlns:"http://jabber.org/protocol/muc"}).up();this.sendCommand(i.tree())},connection.prototype.createGroupNew=function(t){t.data.owner=this.user;var e={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups",dataType:"json",type:"POST",data:JSON.stringify(t.data),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};e.success=function(e){t.success(e),this.onCreateGroup(e)}.bind(this),e.error=t.error||_utils.emptyfn,WebIM.utils.ajax(e)},connection.prototype.blockGroup=function(t){var e=t.groupId;e="notification_ignore_"+e;var n={entities:[]};n.entities[0]={},n.entities[0][e]=!0;var r={type:"PUT",url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/users/"+this.user,data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.joinGroup=function(t){var e={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t.groupId+"/apply",type:"POST",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};e.success=t.success||_utils.emptyfn,e.error=t.error||_utils.emptyfn,WebIM.utils.ajax(e)},connection.prototype.listGroups=function(t){var e=[];if(e.limit=t.limit,e.cursor=t.cursor,e.cursor||delete e.cursor,isNaN(t.limit))throw'The parameter "limit" should be a number';var n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/publicchatgroups",type:"GET",dataType:"json",data:e,headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.getGroupInfo=function(t){var e={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t.groupId,type:"GET",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};e.success=t.success||_utils.emptyfn,e.error=t.error||_utils.emptyfn,WebIM.utils.ajax(e)},connection.prototype.getGroup=function(t){var e={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/users/"+this.user+"/joined_chatgroups",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};e.success=t.success||_utils.emptyfn,e.error=t.error||_utils.emptyfn,WebIM.utils.ajax(e)},connection.prototype.listGroupMember=function(t){if(isNaN(t.pageNum)||t.pageNum<=0)throw'The parameter "pageNum" should be a positive number';if(isNaN(t.pageSize)||t.pageSize<=0)throw'The parameter "pageSize" should be a positive number';if(null===t.groupId&&void 0===t.groupId)throw'The parameter "groupId" should be added';var e=[],n=t.groupId;e.pagenum=t.pageNum,e.pagesize=t.pageSize;var r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+n+"/users",dataType:"json",type:"GET",data:e,headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.mute=function(t){var e=t.groupId,n={usernames:[t.username],mute_duration:t.muteDuration},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/mute",dataType:"json",type:"POST",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"},data:JSON.stringify(n)};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.removeMute=function(t){var e=t.groupId,n=t.username,r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/mute/"+n,dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.getGroupAdmin=function(t){var e=t.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/admin",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.getMuted=function(t){var e=t.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/mute",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.setAdmin=function(t){var e=t.groupId,n={newadmin:t.username},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/admin",type:"POST",dataType:"json",data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.removeAdmin=function(t){var e=t.groupId,n=t.username,r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/admin/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.agreeJoinGroup=function(t){var e=t.groupId,n={applicant:t.applicant,verifyResult:!0,reason:"no clue"},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/apply_verify",type:"POST",dataType:"json",data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.rejectJoinGroup=function(t){var e=t.groupId,n={applicant:t.applicant,verifyResult:!1,reason:"no clue"},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/apply_verify",type:"POST",dataType:"json",data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.groupBlockSingle=function(t){var e=t.groupId,n=t.username,r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/blocks/users/"+n,type:"POST",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.groupBlockMulti=function(t){var e=t.groupId,n=t.usernames,r={usernames:n},i={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/blocks/users",data:JSON.stringify(r),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};i.success=t.success||_utils.emptyfn,i.error=t.error||_utils.emptyfn,WebIM.utils.ajax(i)},connection.prototype.removeGroupBlockSingle=function(t){var e=t.groupId,n=t.username,r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/blocks/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.removeGroupBlockMulti=function(t){var e=t.groupId,n=t.username.join(","),r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/blocks/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.dissolveGroup=function(t){var e=t.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"?version=v3",type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.getGroupBlacklistNew=function(t){var e=t.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/blocks/users",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.quitGroup=function(t){var e=t.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/quit",type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=t.success||_utils.emptyfn,n.error=t.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.modifyGroup=function(t){var e=t.groupId,n={groupname:t.groupName,description:t.description},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e,type:"PUT",data:JSON.stringify(n),dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.removeSingleGroupMember=function(t){var e=t.groupId,n=t.username,r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.removeMultiGroupMember=function(t){var e=t.groupId,n=t.users.join(","),r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=t.success||_utils.emptyfn,r.error=t.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.inviteToGroup=function(t){var e=t.groupId,n=t.users,r={usernames:n},i={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e+"/invite",type:"POST",data:JSON.stringify(r),dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};i.success=t.success||_utils.emptyfn,i.error=t.error||_utils.emptyfn,WebIM.utils.ajax(i)};var WebIM=window.WebIM||{};WebIM.connection=connection,WebIM.utils=_utils,WebIM.statusCode=_code,WebIM.message=_msg.message,WebIM.doQuery=function(t,e,n){void 0!==window.cefQuery&&window.cefQuery({request:t,persistent:!1,onSuccess:e,onFailure:n})},WebIM&&WebIM.config.isDebug&&(Strophe.Connection.prototype.rawOutput=function(t){console.log("%c "+WebIM.utils.ts()+"[send] "+t,"background-color: #e2f7da")}),WebIM&&WebIM.config&&WebIM.config.isSandBox&&(WebIM.config.xmppURL=WebIM.config.xmppURL.replace(".easemob.","-sandbox.easemob."),WebIM.config.apiURL=WebIM.config.apiURL.replace(".easemob.","-sdb.easemob.")),module.exports=WebIM},function(t,e){!function(){e.code={WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR:0,WEBIM_CONNCTION_OPEN_ERROR:1,WEBIM_CONNCTION_AUTH_ERROR:2,WEBIM_CONNCTION_OPEN_USERGRID_ERROR:3,WEBIM_CONNCTION_ATTACH_ERROR:4,WEBIM_CONNCTION_ATTACH_USERGRID_ERROR:5,WEBIM_CONNCTION_REOPEN_ERROR:6,WEBIM_CONNCTION_SERVER_CLOSE_ERROR:7,WEBIM_CONNCTION_SERVER_ERROR:8,WEBIM_CONNCTION_IQ_ERROR:9,WEBIM_CONNCTION_PING_ERROR:10,WEBIM_CONNCTION_NOTIFYVERSION_ERROR:11,WEBIM_CONNCTION_GETROSTER_ERROR:12,WEBIM_CONNCTION_CROSSDOMAIN_ERROR:13,WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES:14,WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR:15,WEBIM_CONNCTION_DISCONNECTED:16,WEBIM_CONNCTION_AJAX_ERROR:17,WEBIM_CONNCTION_JOINROOM_ERROR:18,WEBIM_CONNCTION_GETROOM_ERROR:19,WEBIM_CONNCTION_GETROOMINFO_ERROR:20,WEBIM_CONNCTION_GETROOMMEMBER_ERROR:21,WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR:22,WEBIM_CONNCTION_LOAD_CHATROOM_ERROR:23,WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR:24,WEBIM_CONNCTION_JOINCHATROOM_ERROR:25,WEBIM_CONNCTION_QUITCHATROOM_ERROR:26,WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR:27,WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR:28,WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR:29,WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR:30,WEBIM_CONNCTION_CALLBACK_INNER_ERROR:31,WEBIM_CONNCTION_CLIENT_OFFLINE:32,WEBIM_CONNCTION_CLIENT_LOGOUT:33,WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR:34,WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP:35,WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP:36,WEBIM_CONNECTION_ACCEPT_JOIN_GROUP:37,WEBIM_CONNECTION_DECLINE_JOIN_GROUP:38,WEBIM_CONNECTION_CLOSED:39,WEBIM_UPLOADFILE_BROWSER_ERROR:100,WEBIM_UPLOADFILE_ERROR:101,WEBIM_UPLOADFILE_NO_LOGIN:102,WEBIM_UPLOADFILE_NO_FILE:103,
WEBIM_DOWNLOADFILE_ERROR:200,WEBIM_DOWNLOADFILE_NO_LOGIN:201,WEBIM_DOWNLOADFILE_BROWSER_ERROR:202,WEBIM_MESSAGE_REC_TEXT:300,WEBIM_MESSAGE_REC_TEXT_ERROR:301,WEBIM_MESSAGE_REC_EMOTION:302,WEBIM_MESSAGE_REC_PHOTO:303,WEBIM_MESSAGE_REC_AUDIO:304,WEBIM_MESSAGE_REC_AUDIO_FILE:305,WEBIM_MESSAGE_REC_VEDIO:306,WEBIM_MESSAGE_REC_VEDIO_FILE:307,WEBIM_MESSAGE_REC_FILE:308,WEBIM_MESSAGE_SED_TEXT:309,WEBIM_MESSAGE_SED_EMOTION:310,WEBIM_MESSAGE_SED_PHOTO:311,WEBIM_MESSAGE_SED_AUDIO:312,WEBIM_MESSAGE_SED_AUDIO_FILE:313,WEBIM_MESSAGE_SED_VEDIO:314,WEBIM_MESSAGE_SED_VEDIO_FILE:315,WEBIM_MESSAGE_SED_FILE:316,WEBIM_MESSAGE_SED_ERROR:317,STATUS_INIT:400,STATUS_DOLOGIN_USERGRID:401,STATUS_DOLOGIN_IM:402,STATUS_OPENED:403,STATUS_CLOSING:404,STATUS_CLOSED:405,STATUS_ERROR:406}}()},function(t,e,n){!function(){var t=function(){},r=n(2).code,i=function(){try{return new window.XMLHttpRequest}catch(t){return!1}},o=function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){return!1}},s=function(e){e=e||!0;var n=i()||o();if("withCredentials"in n)return n;if(!e)return n;if(void 0===window.XDomainRequest)return n;var r=new XDomainRequest;return r.readyState=0,r.status=100,r.onreadystatechange=t,r.onload=function(){r.readyState=4,r.status=200;var t=new ActiveXObject("Microsoft.XMLDOM");t.async="false",t.loadXML(r.responseText),r.responseXML=t,r.response=r.responseText,r.onreadystatechange()},r.ontimeout=r.onerror=function(){r.readyState=4,r.status=500,r.onreadystatechange()},r},a=function(){if("ActiveXObject"in window)try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){return 0}else if(navigator.plugins&&navigator.plugins.length>0)return navigator.plugins["Shockwave Flash"];return 0}(),c=s(),u="undefined"!=typeof FormData,l="undefined"!=typeof Blob,h=c.setRequestHeader||!1,d=c.overrideMimeType||!1,p=h&&u,f=p||a,_=h&&(l||d);Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(i){if("object"!==(void 0===i?"undefined":_typeof(i))&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var o,s,a=[];for(o in i)t.call(i,o)&&a.push(o);if(e)for(s=0;s<r;s++)t.call(i,n[s])&&a.push(n[s]);return a}}());var m={hasFormData:u,hasBlob:l,emptyfn:t,isCanSetRequestHeader:h,hasOverrideMimeType:d,isCanUploadFileAsync:p,isCanUploadFile:f,isCanDownLoadFile:_,isSupportWss:function(){var t=[/MQQBrowser[\/]5([.]\d+)?\sTBS/];if(!window.WebSocket)return!1;for(var e=window.navigator.userAgent,n=0,r=t.length;n<r;n++)if(t[n].test(e))return!1;return!0}(),getIEVersion:function(){var t,e=navigator.userAgent,n={4:8,5:9,6:10,7:11};return(t=e.match(/MSIE (\d+)/i))&&t[1]?+t[1]:(t=e.match(/Trident\/(\d+)/i),t&&t[1]?n[t[1]]||null:null)}(),stringify:function(t){if("undefined"!=typeof JSON&&JSON.stringify)return JSON.stringify(t);var e="",n=[];return function t(r){var i=!1;"[object Array]"===Object.prototype.toString.call(r)?(n.push("]","["),i=!0):"[object Object]"===Object.prototype.toString.call(r)&&n.push("}","{");for(var o in r)"[object Null]"===Object.prototype.toString.call(r[o])?r[o]="null":"[object Undefined]"===Object.prototype.toString.call(r[o])&&(r[o]="undefined"),r[o]&&"object"===_typeof(r[o])?e+=","+(i?"":'"'+o+'":'+(i?'"':""))+t(r[o]):e+=',"'+(i?"":o+'":"')+r[o]+'"';return""!=e&&(e=e.slice(1)),n.pop()+e+n.pop()}(t)},login:function(e){var e=e||{},n=e.success||t,i=e.error||t,o=e.appKey||"",s=o.split("#");if(2!==s.length)return i({type:r.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=s[0],c=s[1],u=u||e.https,l=e.user||"",h=e.pwd||"",d=e.apiUrl,p={grant_type:"password",username:l,password:h,timestamp:+new Date},f=m.stringify(p),e={url:d+"/"+a+"/"+c+"/token",dataType:"json",data:f,success:n,error:i};return m.ajax(e)},getFileUrl:function(t){var e={url:"",filename:"",filetype:"",data:""},n="string"==typeof t?document.getElementById(t):t;if(!m.isCanUploadFileAsync||!n)return e;try{if(window.URL.createObjectURL){var r=n.files;if(r.length>0){var i=r.item(0);e.data=i,e.url=window.URL.createObjectURL(i),e.filename=i.name||""}}else{var i=document.getElementById(t).value;e.url=i;var o=i.lastIndexOf("/"),s=i.lastIndexOf("\\"),a=Math.max(o,s);e.filename=a<0?i:i.substring(a+1)}var c=e.filename.lastIndexOf(".");return-1!=c&&(e.filetype=e.filename.substring(c+1).toLowerCase()),e}catch(t){throw t}},getFileSize:function(t){var e=this.getFileLength(t);if(e>1e7)return!1;var n=Math.round(e/1e3);if(n<1e3)e=n+" KB";else if(n>=1e3){var r=n/1e3;if(r<1e3)e=r.toFixed(1)+" MB";else{var i=r/1e3;e=i.toFixed(1)+" GB"}}return e},getFileLength:function(t){var e=0;if(t)if(t.files)t.files.length>0&&(e=t.files[0].size);else if(t.select&&"ActiveXObject"in window){t.select();var n=new ActiveXObject("Scripting.FileSystemObject"),t=n.GetFile(t.value);e=t.Size}return e},hasFlash:a,trim:function(t){return t="string"==typeof t?t:"",t.trim?t.trim():t.replace(/^\s|\s$/g,"")},parseEmoji:function(t){if(void 0===WebIM.Emoji||void 0===WebIM.Emoji.map)return t;var e=WebIM.Emoji;for(var n in e.map)if(e.map.hasOwnProperty(n))for(;t.indexOf(n)>-1;)t=t.replace(n,'<img class="emoji" src="'+e.path+e.map[n]+'" />');return t},parseLink:function(t){var e=/(https?\:\/\/|www\.)([a-zA-Z0-9-]+(\.[a-zA-Z0-9]+)+)(\:[0-9]{2,4})?\/?((\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\/?)*\??[:_#@*&%0-9a-zA-Z-\/=]*/gm;return t=t.replace(e,function(t){return"<a href='"+(/^https?/gm.test(t)?t:"//"+t)+"' target='_blank'>"+t+"</a>"})},parseJSON:function(t){if(window.JSON&&window.JSON.parse)return window.JSON.parse(t+"");var e,n=null,r=m.trim(t+"");return r&&!m.trim(r.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,function(t,r,i,o){return e&&r&&(n=0),0===n?t:(e=i||r,n+=!o-!i,"")}))?Function("return "+r)():Function("Invalid JSON: "+t)()},parseUploadResponse:function(t){return t.indexOf("callback")>-1?t.slice(9,-1):t},parseDownloadResponse:function(t){return t&&t.type&&"application/json"===t.type||0>Object.prototype.toString.call(t).indexOf("Blob")?this.url+"?token=":window.URL.createObjectURL(t)},uploadFile:function(e){var e=e||{};e.onFileUploadProgress=e.onFileUploadProgress||t,e.onFileUploadComplete=e.onFileUploadComplete||t,e.onFileUploadError=e.onFileUploadError||t,e.onFileUploadCanceled=e.onFileUploadCanceled||t;var n=e.accessToken||this.context.accessToken;if(!n)return void e.onFileUploadError({type:r.WEBIM_UPLOADFILE_NO_LOGIN,id:e.id});var i,o,s,a=e.appKey||this.context.appKey||"";if(a&&(s=a.split("#"),i=s[0],o=s[1]),!i&&!o)return void e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:e.id});var c=e.apiUrl,u=c+"/"+i+"/"+o+"/chatfiles";if(!m.isCanUploadFileAsync)return void(m.hasFlash&&"function"==typeof e.flashUpload?e.flashUpload&&e.flashUpload(u,e):e.onFileUploadError({type:r.WEBIM_UPLOADFILE_BROWSER_ERROR,id:e.id}));var l=e.file.data?e.file.data.size:void 0;if(l>10485760)return void e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:e.id});if(l<=0)return void e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:e.id});var h=m.xmlrequest(),d=function(t){e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:e.id,xhr:h})};h.upload&&h.upload.addEventListener("progress",e.onFileUploadProgress,!1),h.addEventListener?(h.addEventListener("abort",e.onFileUploadCanceled,!1),h.addEventListener("load",function(t){try{var n=m.parseJSON(h.responseText);try{e.onFileUploadComplete(n)}catch(t){e.onFileUploadError({type:r.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:t})}}catch(t){e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,data:h.responseText,id:e.id,xhr:h})}},!1),h.addEventListener("error",d,!1)):h.onreadystatechange&&(h.onreadystatechange=function(){if(4===h.readyState)if(200===ajax.status)try{var t=m.parseJSON(h.responseText);e.onFileUploadComplete(t)}catch(t){e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,data:h.responseText,id:e.id,xhr:h})}else e.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,data:h.responseText,id:e.id,xhr:h});else h.abort(),e.onFileUploadCanceled()}),h.open("POST",u),h.setRequestHeader("restrict-access","true"),h.setRequestHeader("Accept","*/*"),h.setRequestHeader("Authorization","Bearer "+n);var p=new FormData;p.append("file",e.file.data),window.XDomainRequest&&(h.readyState=2),h.send(p)},download:function(e){e.onFileDownloadComplete=e.onFileDownloadComplete||t,e.onFileDownloadError=e.onFileDownloadError||t;var n=e.accessToken||this.context.accessToken;if(!n)return void e.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_NO_LOGIN,id:e.id});var i=function(t){e.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:o})};if(!m.isCanDownLoadFile)return void e.onFileDownloadComplete();var o=m.xmlrequest();"addEventListener"in o?(o.addEventListener("load",function(t){e.onFileDownloadComplete(o.response,o)},!1),o.addEventListener("error",i,!1)):"onreadystatechange"in o&&(o.onreadystatechange=function(){4===o.readyState?200===ajax.status?e.onFileDownloadComplete(o.response,o):e.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:o}):(o.abort(),e.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:o}))});var s=e.method||"GET",a=e.responseType||"blob",c=e.mimeType||"text/plain; charset=x-user-defined";o.open(s,e.url),"undefined"!=typeof Blob?o.responseType=a:o.overrideMimeType(c);var u={"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream","share-secret":e.secret,Authorization:"Bearer "+n},l=e.headers||{};for(var h in l)u[h]=l[h];for(var h in u)u[h]&&o.setRequestHeader(h,u[h]);window.XDomainRequest&&(o.readyState=2),o.send(null)},parseTextMessage:function(t,e){if("string"==typeof t){if("[object Object]"!==Object.prototype.toString.call(e))return{isemoji:!1,body:[{type:"txt",data:t}]};var n=t,r=[],i=/\[[^[\]]{2,3}\]/gm,o=n.match(i);if(!o||o.length<1)return{isemoji:!1,body:[{type:"txt",data:t}]};for(var s=!1,a=0;a<o.length;a++){var c=n.substring(0,n.indexOf(o[a])),u=WebIM.Emoji.map[o[a]];if(c&&r.push({type:"txt",data:c}),u){var l=WebIM.Emoji.map?WebIM.Emoji.path+u:null;l?(s=!0,r.push({type:"emoji",data:l})):r.push({type:"txt",data:o[a]});var h=n.indexOf(o[a])+o[a].length;n=n.substring(h)}else r.push({type:"txt",data:o[a]})}return n&&r.push({type:"txt",data:n}),s?{isemoji:s,body:r}:{isemoji:!1,body:[{type:"txt",data:t}]}}},parseUri:function(){var t=/([^\?|&])\w+=([^&]+)/g,e={};if(window.location.search){var n=window.location.search.match(t);for(var r in n){var i=n[r],o=i.indexOf("="),s=i.substr(0,o),a=i.substr(o+1);e[s]=a}}return e},parseHrefHash:function(){var t=/([^\#|&])\w+=([^&]+)/g,e={};if(window.location.hash){var n=window.location.hash.match(t);for(var r in n){var i=n[r],o=i.indexOf("="),s=i.substr(0,o),a=i.substr(o+1);e[s]=a}}return e},xmlrequest:s,getXmlFirstChild:function(t,e){var n=t.getElementsByTagName(e);return 0==n.length?null:n[0]},ajax:function(e){var n=e.dataType||"text",i=e.success||t,o=e.error||t,s=m.xmlrequest();s.onreadystatechange=function(){if(4===s.readyState){if(200===(s.status||0)){try{switch(n){case"text":return void i(s.responseText);case"json":var t=m.parseJSON(s.responseText);return void i(t,s);case"xml":return void(s.responseXML&&s.responseXML.documentElement?i(s.responseXML.documentElement,s):o({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText}))}i(s.response||s.responseText,s)}catch(t){o({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:t})}return}return void o({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText})}0===s.readyState&&o({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText})},e.responseType&&s.responseType&&(s.responseType=e.responseType),e.mimeType&&m.hasOverrideMimeType&&s.overrideMimeType(e.mimeType);var a=e.type||"POST",c=e.data||null,u="";if("get"===a.toLowerCase()&&c){for(var l in c)c.hasOwnProperty(l)&&(u+=l+"="+c[l]+"&");u=u?u.slice(0,-1):u,e.url+=(e.url.indexOf("?")>0?"&":"?")+(u?u+"&":u)+"_v="+(new Date).getTime(),c=null,u=null}if(s.open(a,e.url,m.isCanSetRequestHeader),m.isCanSetRequestHeader){var h=e.headers||{};for(var d in h)h.hasOwnProperty(d)&&s.setRequestHeader(d,h[d])}return window.XDomainRequest&&(s.readyState=2),s.send(c),s},ts:function(){var t=new Date,e=t.getHours(),n=t.getMinutes(),r=t.getSeconds(),i=t.getMilliseconds();return(e<10?"0"+e:e)+":"+(n<10?"0"+n:n)+":"+(r<10?"0"+r:r)+":"+i+" "},getObjectKey:function(t,e){for(var n in t)if(t[n]==e)return n;return""},sprintf:function(){var t,e,n=arguments,r=n[0]||"";for(t=1,e=n.length;t<e;t++)r=r.replace(/%s/,n[t]);return r},setCookie:function(t,e,n){var r=t+"="+encodeURIComponent(e);"number"==typeof n&&(r+="; max-age: "+60*n*60*24),document.cookie=r},getCookie:function(){var t={},e=document.cookie;if(""===e)return t;for(var n=e.split("; "),r=0;r<n.length;r++){var i=n[r],o=i.indexOf("="),s=i.substring(0,o),a=i.substring(o+1);a=decodeURIComponent(a),t[s]=a}return t}};e.utils=m}()},function(t,e,n){n(5);!function(){var t=n(3).utils,r=function t(e,n){return!this instanceof t?new t(e):(this._msg={},"function"==typeof t[e]&&(t[e].prototype.setGroup=this.setGroup,this._msg=new t[e](n)),this._msg)};r.prototype.setGroup=function(t){this.body.group=t},r.read=function(t){this.id=t,this.type="read"},r.read.prototype.set=function(t){this.body={ackId:t.id,to:t.to}},r.delivery=function(t){this.id=t,this.type="delivery"},r.delivery.prototype.set=function(t){this.body={bodyId:t.id,to:t.to}},r.txt=function(t){this.id=t,this.type="txt",this.body={}},r.txt.prototype.set=function(t){this.value=t.msg,this.body={id:this.id,to:t.to,msg:this.value,type:this.type,roomType:t.roomType,ext:t.ext||{},success:t.success,fail:t.fail},!t.roomType&&delete this.body.roomType},r.cmd=function(t){this.id=t,this.type="cmd",this.body={}},r.cmd.prototype.set=function(t){this.value="",this.body={to:t.to,action:t.action,msg:this.value,type:this.type,roomType:t.roomType,ext:t.ext||{},success:t.success},!t.roomType&&delete this.body.roomType},r.location=function(t){this.id=t,this.type="loc",this.body={}},r.location.prototype.set=function(t){this.body={to:t.to,type:this.type,roomType:t.roomType,addr:t.addr,lat:t.lat,lng:t.lng,ext:t.ext||{}}},r.img=function(t){this.id=t,this.type="img",this.body={}},r.img.prototype.set=function(e){e.file=e.file||t.getFileUrl(e.fileInputId),this.value=e.file,this.body={id:this.id,file:this.value,apiUrl:e.apiUrl,to:e.to,type:this.type,ext:e.ext||{},roomType:e.roomType,onFileUploadError:e.onFileUploadError,onFileUploadComplete:e.onFileUploadComplete,success:e.success,fail:e.fail,flashUpload:e.flashUpload,width:e.width,height:e.height,body:e.body,uploadError:e.uploadError,uploadComplete:e.uploadComplete},!e.roomType&&delete this.body.roomType},r.audio=function(t){this.id=t,this.type="audio",this.body={}},r.audio.prototype.set=function(e){e.file=e.file||t.getFileUrl(e.fileInputId),this.value=e.file,this.filename=e.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:e.apiUrl,to:e.to,type:this.type,ext:e.ext||{},length:e.length||0,roomType:e.roomType,file_length:e.file_length,onFileUploadError:e.onFileUploadError,onFileUploadComplete:e.onFileUploadComplete,success:e.success,fail:e.fail,flashUpload:e.flashUpload,body:e.body},!e.roomType&&delete this.body.roomType},r.file=function(t){this.id=t,this.type="file",this.body={}},r.file.prototype.set=function(e){e.file=e.file||t.getFileUrl(e.fileInputId),this.value=e.file,this.filename=e.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:e.apiUrl,to:e.to,type:this.type,ext:e.ext||{},roomType:e.roomType,onFileUploadError:e.onFileUploadError,onFileUploadComplete:e.onFileUploadComplete,success:e.success,fail:e.fail,flashUpload:e.flashUpload,body:e.body},!e.roomType&&delete this.body.roomType},r.video=function(t){},r.video.prototype.set=function(t){};var i=function t(e){if(!this instanceof t)return new t(e,conn);this.msg=e};i.prototype.send=function(e){var n=this,r=function(n){n.ext=n.ext||{},n.ext.weichat=n.ext.weichat||{},n.ext.weichat.originType=n.ext.weichat.originType||"webim";var r,i={from:e.context.userId||"",to:n.to,bodies:[n.body],ext:n.ext||{}},o=t.stringify(i);if(r=$msg({type:n.group||"chat",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(o),n.roomType&&r.up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"}),n.bodyId){r=$msg({from:e.context.jid||"",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(n.bodyId);var s={xmlns:"urn:xmpp:receipts",id:n.bodyId};r.up().c("delivery",s)}if(n.ackId){if(e.context.jid.indexOf(n.toJid)>=0)return;r=$msg({from:e.context.jid||"",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(n.ackId);var a={xmlns:"urn:xmpp:receipts",id:n.ackId};r.up().c("acked",a)}setTimeout(function(){"undefined"!=typeof _msgHash&&_msgHash[n.id]&&_msgHash[n.id].msg.fail instanceof Function&&_msgHash[n.id].msg.fail(n.id)},6e4),e.sendCommand(r.tree(),n.id)};if(n.msg.file){if(n.msg.body&&n.msg.body.url)return void r(n.msg);var i=n.msg.onFileUploadComplete,o=function(t){if(t.entities[0]["file-metadata"]){var o=t.entities[0]["file-metadata"]["content-length"];n.msg.filetype=t.entities[0]["file-metadata"]["content-type"],o>204800&&(n.msg.thumbnail=!0)}n.msg.body={type:n.msg.type||"file",url:("https:"!=location.protocol&&e.isHttpDNS?e.apiUrl+t.uri.substr(t.uri.indexOf("/",9)):t.uri)+"/"+t.entities[0].uuid,secret:t.entities[0]["share-secret"],filename:n.msg.file.filename||n.msg.filename,size:{width:n.msg.width||0,height:n.msg.height||0},length:n.msg.length||0,file_length:n.msg.ext.file_length||0,filetype:n.msg.filetype},r(n.msg),i instanceof Function&&i(t,n.msg.id)};n.msg.onFileUploadComplete=o,t.uploadFile.call(e,n.msg)}else n.msg.body={type:"chat"===n.msg.type?"txt":n.msg.type,msg:n.msg.msg},"cmd"===n.msg.type?n.msg.body.action=n.msg.action:"loc"===n.msg.type&&(n.msg.body.addr=n.msg.addr,n.msg.body.lat=n.msg.lat,n.msg.body.lng=n.msg.lng),r(n.msg)},e._msg=i,e.message=r}()},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(13),n(14),n(15),n(16),n(17),n(18),n(19),n(20),n(21),n(22),n(23),n(24),n(25),n(26),n(27),n(28),n(29),n(30),n(31),n(32),n(33),n(34),n(35),n(36),n(37),n(38))}(0,function(t){return t})},function(t,e,n){!function(n,r){t.exports=e=r()}(0,function(){var t=t||function(t,e){var n=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),r={},i=r.lib={},o=i.Base=function(){return{extend:function(t){var e=n(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=i.WordArray=o.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:4*t.length},toString:function(t){return(t||c).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,i=t.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;e[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var o=0;o<i;o+=4)e[r+o>>>2]=n[o>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=o.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n,r=[],i=0;i<e;i+=4){var o=function(e){var e=e,n=987654321,r=4294967295;return function(){n=36969*(65535&n)+(n>>16)&r,e=18e3*(65535&e)+(e>>16)&r;var i=(n<<16)+e&r;return i/=4294967296,(i+=.5)*(t.random()>.5?1:-1)}}(4294967296*(n||t.random()));n=987654071*o(),r.push(4294967296*o()|0)}return new s.init(r,e)}}),a=r.enc={},c=a.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],i=0;i<n;i++){var o=e[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new s.init(n,e/2)}},u=a.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],i=0;i<n;i++){var o=e[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new s.init(n,e)}},l=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},h=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=l.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,a=4*o,c=i/a;c=e?t.ceil(c):t.max((0|c)-this._minBufferSize,0);var u=c*o,l=t.min(4*u,i);if(u){for(var h=0;h<u;h+=o)this._doProcessBlock(r,h);var d=r.splice(0,u);n.sigBytes-=l}return new s.init(d,l)},clone:function(){var t=o.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),d=(i.Hasher=h.extend({cfg:o.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new d.HMAC.init(t,n).finalize(e)}}}),r.algo={});return r}(Math);return t})},function(t,e,n){!function(r,i){t.exports=e=i(n(6))}(0,function(t){return function(e){var n=t,r=n.lib,i=r.Base,o=r.WordArray,s=n.x64={};s.Word=i.extend({init:function(t,e){this.high=t,this.low=e}}),s.WordArray=i.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:8*t.length},toX32:function(){for(var t=this.words,e=t.length,n=[],r=0;r<e;r++){var i=t[r];n.push(i.high),n.push(i.low)}return o.create(n,this.sigBytes)},clone:function(){for(var t=i.clone.call(this),e=t.words=this.words.slice(0),n=e.length,r=0;r<n;r++)e[r]=e[r].clone();return t}})}(),t})},function(t,e,n){!function(r,i){t.exports=e=i(n(6))}(0,function(t){return function(){if("function"==typeof ArrayBuffer){var e=t,n=e.lib,r=n.WordArray,i=r.init;(r.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var e=t.byteLength,n=[],r=0;r<e;r++)n[r>>>2]|=t[r]<<24-r%4*8;i.call(this,n,e)}else i.apply(this,arguments)}).prototype=r}}(),t.lib.WordArray})},function(t,e,n){!function(r,i){t.exports=e=i(n(6))}(0,function(t){return function(){function e(t){return t<<8&4278255360|t>>>8&16711935}var n=t,r=n.lib,i=r.WordArray,o=n.enc;o.Utf16=o.Utf16BE={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],i=0;i<n;i+=2){var o=e[i>>>2]>>>16-i%4*8&65535;r.push(String.fromCharCode(o))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>1]|=t.charCodeAt(r)<<16-r%2*16;return i.create(n,2*e)}};o.Utf16LE={stringify:function(t){for(var n=t.words,r=t.sigBytes,i=[],o=0;o<r;o+=2){var s=e(n[o>>>2]>>>16-o%4*8&65535);i.push(String.fromCharCode(s))}return i.join("")},parse:function(t){for(var n=t.length,r=[],o=0;o<n;o++)r[o>>>1]|=e(t.charCodeAt(o)<<16-o%2*16);return i.create(r,2*n)}}}(),t.enc.Utf16})},function(t,e,n){!function(r,i){t.exports=e=i(n(6))}(0,function(t){return function(){function e(t,e,n){for(var r=[],o=0,s=0;s<e;s++)if(s%4){var a=n[t.charCodeAt(s-1)]<<s%4*2,c=n[t.charCodeAt(s)]>>>6-s%4*2;r[o>>>2]|=(a|c)<<24-o%4*8,o++}return i.create(r,o)}var n=t,r=n.lib,i=r.WordArray,o=n.enc;o.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,r=this._map;t.clamp();for(var i=[],o=0;o<n;o+=3)for(var s=e[o>>>2]>>>24-o%4*8&255,a=e[o+1>>>2]>>>24-(o+1)%4*8&255,c=e[o+2>>>2]>>>24-(o+2)%4*8&255,u=s<<16|a<<8|c,l=0;l<4&&o+.75*l<n;l++)i.push(r.charAt(u>>>6*(3-l)&63));var h=r.charAt(64);if(h)for(;i.length%4;)i.push(h);return i.join("")},parse:function(t){var n=t.length,r=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<r.length;o++)i[r.charCodeAt(o)]=o}var s=r.charAt(64);if(s){var a=t.indexOf(s);-1!==a&&(n=a)}return e(t,n,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),t.enc.Base64})},function(t,e,n){!function(r,i){t.exports=e=i(n(6))}(0,function(t){return function(e){function n(t,e,n,r,i,o,s){var a=t+(e&n|~e&r)+i+s;return(a<<o|a>>>32-o)+e}function r(t,e,n,r,i,o,s){var a=t+(e&r|n&~r)+i+s;return(a<<o|a>>>32-o)+e}function i(t,e,n,r,i,o,s){var a=t+(e^n^r)+i+s;return(a<<o|a>>>32-o)+e}function o(t,e,n,r,i,o,s){var a=t+(n^(e|~r))+i+s;return(a<<o|a>>>32-o)+e}var s=t,a=s.lib,c=a.WordArray,u=a.Hasher,l=s.algo,h=[];!function(){for(var t=0;t<64;t++)h[t]=4294967296*e.abs(e.sin(t+1))|0}();var d=l.MD5=u.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var s=0;s<16;s++){var a=e+s,c=t[a];t[a]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var u=this._hash.words,l=t[e+0],d=t[e+1],p=t[e+2],f=t[e+3],_=t[e+4],m=t[e+5],g=t[e+6],y=t[e+7],v=t[e+8],b=t[e+9],N=t[e+10],E=t[e+11],S=t[e+12],T=t[e+13],x=t[e+14],O=t[e+15],I=u[0],C=u[1],R=u[2],A=u[3];I=n(I,C,R,A,l,7,h[0]),A=n(A,I,C,R,d,12,h[1]),R=n(R,A,I,C,p,17,h[2]),C=n(C,R,A,I,f,22,h[3]),I=n(I,C,R,A,_,7,h[4]),A=n(A,I,C,R,m,12,h[5]),R=n(R,A,I,C,g,17,h[6]),C=n(C,R,A,I,y,22,h[7]),I=n(I,C,R,A,v,7,h[8]),A=n(A,I,C,R,b,12,h[9]),R=n(R,A,I,C,N,17,h[10]),C=n(C,R,A,I,E,22,h[11]),I=n(I,C,R,A,S,7,h[12]),A=n(A,I,C,R,T,12,h[13]),R=n(R,A,I,C,x,17,h[14]),C=n(C,R,A,I,O,22,h[15]),I=r(I,C,R,A,d,5,h[16]),A=r(A,I,C,R,g,9,h[17]),R=r(R,A,I,C,E,14,h[18]),C=r(C,R,A,I,l,20,h[19]),I=r(I,C,R,A,m,5,h[20]),A=r(A,I,C,R,N,9,h[21]),R=r(R,A,I,C,O,14,h[22]),C=r(C,R,A,I,_,20,h[23]),I=r(I,C,R,A,b,5,h[24]),A=r(A,I,C,R,x,9,h[25]),R=r(R,A,I,C,f,14,h[26]),C=r(C,R,A,I,v,20,h[27]),I=r(I,C,R,A,T,5,h[28]),A=r(A,I,C,R,p,9,h[29]),R=r(R,A,I,C,y,14,h[30]),C=r(C,R,A,I,S,20,h[31]),I=i(I,C,R,A,m,4,h[32]),A=i(A,I,C,R,v,11,h[33]),R=i(R,A,I,C,E,16,h[34]),C=i(C,R,A,I,x,23,h[35]),I=i(I,C,R,A,d,4,h[36]),A=i(A,I,C,R,_,11,h[37]),R=i(R,A,I,C,y,16,h[38]),C=i(C,R,A,I,N,23,h[39]),I=i(I,C,R,A,T,4,h[40]),A=i(A,I,C,R,l,11,h[41]),R=i(R,A,I,C,f,16,h[42]),C=i(C,R,A,I,g,23,h[43]),I=i(I,C,R,A,b,4,h[44]),A=i(A,I,C,R,S,11,h[45]),R=i(R,A,I,C,O,16,h[46]),C=i(C,R,A,I,p,23,h[47]),I=o(I,C,R,A,l,6,h[48]),A=o(A,I,C,R,y,10,h[49]),R=o(R,A,I,C,x,15,h[50]),C=o(C,R,A,I,m,21,h[51]),I=o(I,C,R,A,S,6,h[52]),A=o(A,I,C,R,f,10,h[53]),R=o(R,A,I,C,N,15,h[54]),C=o(C,R,A,I,d,21,h[55]),I=o(I,C,R,A,v,6,h[56]),A=o(A,I,C,R,O,10,h[57]),R=o(R,A,I,C,g,15,h[58]),C=o(C,R,A,I,T,21,h[59]),I=o(I,C,R,A,_,6,h[60]),A=o(A,I,C,R,E,10,h[61]),R=o(R,A,I,C,p,15,h[62]),C=o(C,R,A,I,b,21,h[63]),u[0]=u[0]+I|0,u[1]=u[1]+C|0,u[2]=u[2]+R|0,u[3]=u[3]+A|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var o=e.floor(r/4294967296),s=r;n[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return a},clone:function(){var t=u.clone.call(this);return t._hash=this._hash.clone(),t}});s.MD5=u._createHelper(d),s.HmacMD5=u._createHmacHelper(d)}(Math),t.MD5})},function(t,e,n){!function(r,i){t.exports=e=i(n(6))}(0,function(t){return function(){var e=t,n=e.lib,r=n.WordArray,i=n.Hasher,o=e.algo,s=[],a=o.SHA1=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],a=n[3],c=n[4],u=0;u<80;u++){if(u<16)s[u]=0|t[e+u];else{var l=s[u-3]^s[u-8]^s[u-14]^s[u-16];s[u]=l<<1|l>>>31}var h=(r<<5|r>>>27)+c+s[u];h+=u<20?1518500249+(i&o|~i&a):u<40?1859775393+(i^o^a):u<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,c=a,a=o,o=i<<30|i>>>2,i=r,r=h}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),e[15+(r+64>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA1=i._createHelper(a),e.HmacSHA1=i._createHmacHelper(a)}(),t.SHA1})},function(t,e,n){!function(r,i){t.exports=e=i(n(6))}(0,function(t){return function(e){var n=t,r=n.lib,i=r.WordArray,o=r.Hasher,s=n.algo,a=[],c=[];!function(){function t(t){return 4294967296*(t-(0|t))|0}for(var n=2,r=0;r<64;)(function(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0})(n)&&(r<8&&(a[r]=t(e.pow(n,.5))),c[r]=t(e.pow(n,1/3)),r++),n++}();var u=[],l=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],l=n[5],h=n[6],d=n[7],p=0;p<64;p++){if(p<16)u[p]=0|t[e+p];else{var f=u[p-15],_=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,m=u[p-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[p]=_+u[p-7]+g+u[p-16]}var y=a&l^~a&h,v=r&i^r&o^i&o,b=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),N=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),E=d+N+y+c[p]+u[p],S=b+v;d=h,h=l,l=a,a=s+E|0,s=o,o=i,i=r,r=E+S|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+h|0,n[7]=n[7]+d|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});n.SHA256=o._createHelper(l),n.HmacSHA256=o._createHmacHelper(l)}(Math),t.SHA256})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(13))}(0,function(t){return function(){var e=t,n=e.lib,r=n.WordArray,i=e.algo,o=i.SHA256,s=i.SHA224=o.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=o._doFinalize.call(this);return t.sigBytes-=4,t}});e.SHA224=o._createHelper(s),e.HmacSHA224=o._createHmacHelper(s)}(),t.SHA224})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(7))}(0,function(t){return function(){function e(){return s.create.apply(s,arguments)}
var n=t,r=n.lib,i=r.Hasher,o=n.x64,s=o.Word,a=o.WordArray,c=n.algo,u=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],l=[];!function(){for(var t=0;t<80;t++)l[t]=e()}();var h=c.SHA512=i.extend({_doReset:function(){this._hash=new a.init([new s.init(1779033703,4089235720),new s.init(3144134277,2227873595),new s.init(1013904242,4271175723),new s.init(2773480762,1595750129),new s.init(1359893119,2917565137),new s.init(2600822924,725511199),new s.init(528734635,4215389547),new s.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=n[5],h=n[6],d=n[7],p=r.high,f=r.low,_=i.high,m=i.low,g=o.high,y=o.low,v=s.high,b=s.low,N=a.high,E=a.low,S=c.high,T=c.low,x=h.high,O=h.low,I=d.high,C=d.low,R=p,A=f,M=_,w=m,B=g,k=y,D=v,j=b,H=N,L=E,F=S,U=T,W=x,q=O,G=I,P=C,J=0;J<80;J++){var z=l[J];if(J<16)var X=z.high=0|t[e+2*J],$=z.low=0|t[e+2*J+1];else{var K=l[J-15],Q=K.high,V=K.low,Y=(Q>>>1|V<<31)^(Q>>>8|V<<24)^Q>>>7,Z=(V>>>1|Q<<31)^(V>>>8|Q<<24)^(V>>>7|Q<<25),tt=l[J-2],et=tt.high,nt=tt.low,rt=(et>>>19|nt<<13)^(et<<3|nt>>>29)^et>>>6,it=(nt>>>19|et<<13)^(nt<<3|et>>>29)^(nt>>>6|et<<26),ot=l[J-7],st=ot.high,at=ot.low,ct=l[J-16],ut=ct.high,lt=ct.low,$=Z+at,X=Y+st+($>>>0<Z>>>0?1:0),$=$+it,X=X+rt+($>>>0<it>>>0?1:0),$=$+lt,X=X+ut+($>>>0<lt>>>0?1:0);z.high=X,z.low=$}var ht=H&F^~H&W,dt=L&U^~L&q,pt=R&M^R&B^M&B,ft=A&w^A&k^w&k,_t=(R>>>28|A<<4)^(R<<30|A>>>2)^(R<<25|A>>>7),mt=(A>>>28|R<<4)^(A<<30|R>>>2)^(A<<25|R>>>7),gt=(H>>>14|L<<18)^(H>>>18|L<<14)^(H<<23|L>>>9),yt=(L>>>14|H<<18)^(L>>>18|H<<14)^(L<<23|H>>>9),vt=u[J],bt=vt.high,Nt=vt.low,Et=P+yt,St=G+gt+(Et>>>0<P>>>0?1:0),Et=Et+dt,St=St+ht+(Et>>>0<dt>>>0?1:0),Et=Et+Nt,St=St+bt+(Et>>>0<Nt>>>0?1:0),Et=Et+$,St=St+X+(Et>>>0<$>>>0?1:0),Tt=mt+ft,xt=_t+pt+(Tt>>>0<mt>>>0?1:0);G=W,P=q,W=F,q=U,F=H,U=L,L=j+Et|0,H=D+St+(L>>>0<j>>>0?1:0)|0,D=B,j=k,B=M,k=w,M=R,w=A,A=Et+Tt|0,R=St+xt+(A>>>0<Et>>>0?1:0)|0}f=r.low=f+A,r.high=p+R+(f>>>0<A>>>0?1:0),m=i.low=m+w,i.high=_+M+(m>>>0<w>>>0?1:0),y=o.low=y+k,o.high=g+B+(y>>>0<k>>>0?1:0),b=s.low=b+j,s.high=v+D+(b>>>0<j>>>0?1:0),E=a.low=E+L,a.high=N+H+(E>>>0<L>>>0?1:0),T=c.low=T+U,c.high=S+F+(T>>>0<U>>>0?1:0),O=h.low=O+q,h.high=x+W+(O>>>0<q>>>0?1:0),C=d.low=C+P,d.high=I+G+(C>>>0<P>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),e[31+(r+128>>>10<<5)]=n,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32});n.SHA512=i._createHelper(h),n.HmacSHA512=i._createHmacHelper(h)}(),t.SHA512})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(7),n(15))}(0,function(t){return function(){var e=t,n=e.x64,r=n.Word,i=n.WordArray,o=e.algo,s=o.SHA512,a=o.SHA384=s.extend({_doReset:function(){this._hash=new i.init([new r.init(3418070365,3238371032),new r.init(1654270250,914150663),new r.init(2438529370,812702999),new r.init(355462360,4144912697),new r.init(1731405415,4290775857),new r.init(2394180231,1750603025),new r.init(3675008525,1694076839),new r.init(1203062813,3204075428)])},_doFinalize:function(){var t=s._doFinalize.call(this);return t.sigBytes-=16,t}});e.SHA384=s._createHelper(a),e.HmacSHA384=s._createHmacHelper(a)}(),t.SHA384})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(7))}(0,function(t){return function(e){var n=t,r=n.lib,i=r.WordArray,o=r.Hasher,s=n.x64,a=s.Word,c=n.algo,u=[],l=[],h=[];!function(){for(var t=1,e=0,n=0;n<24;n++){u[t+5*e]=(n+1)*(n+2)/2%64;var r=e%5,i=(2*t+3*e)%5;t=r,e=i}for(var t=0;t<5;t++)for(var e=0;e<5;e++)l[t+5*e]=e+(2*t+3*e)%5*5;for(var o=1,s=0;s<24;s++){for(var c=0,d=0,p=0;p<7;p++){if(1&o){var f=(1<<p)-1;f<32?d^=1<<f:c^=1<<f-32}128&o?o=o<<1^113:o<<=1}h[s]=a.create(c,d)}}();var d=[];!function(){for(var t=0;t<25;t++)d[t]=a.create()}();var p=c.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var t=this._state=[],e=0;e<25;e++)t[e]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(t,e){for(var n=this._state,r=this.blockSize/2,i=0;i<r;i++){var o=t[e+2*i],s=t[e+2*i+1];o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8);var a=n[i];a.high^=s,a.low^=o}for(var c=0;c<24;c++){for(var p=0;p<5;p++){for(var f=0,_=0,m=0;m<5;m++){var a=n[p+5*m];f^=a.high,_^=a.low}var g=d[p];g.high=f,g.low=_}for(var p=0;p<5;p++)for(var y=d[(p+4)%5],v=d[(p+1)%5],b=v.high,N=v.low,f=y.high^(b<<1|N>>>31),_=y.low^(N<<1|b>>>31),m=0;m<5;m++){var a=n[p+5*m];a.high^=f,a.low^=_}for(var E=1;E<25;E++){var a=n[E],S=a.high,T=a.low,x=u[E];if(x<32)var f=S<<x|T>>>32-x,_=T<<x|S>>>32-x;else var f=T<<x-32|S>>>64-x,_=S<<x-32|T>>>64-x;var O=d[l[E]];O.high=f,O.low=_}var I=d[0],C=n[0];I.high=C.high,I.low=C.low;for(var p=0;p<5;p++)for(var m=0;m<5;m++){var E=p+5*m,a=n[E],R=d[E],A=d[(p+1)%5+5*m],M=d[(p+2)%5+5*m];a.high=R.high^~A.high&M.high,a.low=R.low^~A.low&M.low}var a=n[0],w=h[c];a.high^=w.high,a.low^=w.low}},_doFinalize:function(){var t=this._data,n=t.words,r=(this._nDataBytes,8*t.sigBytes),o=32*this.blockSize;n[r>>>5]|=1<<24-r%32,n[(e.ceil((r+1)/o)*o>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var s=this._state,a=this.cfg.outputLength/8,c=a/8,u=[],l=0;l<c;l++){var h=s[l],d=h.high,p=h.low;d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),u.push(p),u.push(d)}return new i.init(u,a)},clone:function(){for(var t=o.clone.call(this),e=t._state=this._state.slice(0),n=0;n<25;n++)e[n]=e[n].clone();return t}});n.SHA3=o._createHelper(p),n.HmacSHA3=o._createHmacHelper(p)}(Math),t.SHA3})},function(t,e,n){!function(r,i){t.exports=e=i(n(6))}(0,function(t){return function(e){function n(t,e,n){return t^e^n}function r(t,e,n){return t&e|~t&n}function i(t,e,n){return(t|~e)^n}function o(t,e,n){return t&n|e&~n}function s(t,e,n){return t^(e|~n)}function a(t,e){return t<<e|t>>>32-e}var c=t,u=c.lib,l=u.WordArray,h=u.Hasher,d=c.algo,p=l.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),f=l.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),_=l.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),m=l.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),g=l.create([0,1518500249,1859775393,2400959708,2840853838]),y=l.create([1352829926,1548603684,1836072691,2053994217,0]),v=d.RIPEMD160=h.extend({_doReset:function(){this._hash=l.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var c=0;c<16;c++){var u=e+c,l=t[u];t[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var h,d,v,b,N,E,S,T,x,O,I=this._hash.words,C=g.words,R=y.words,A=p.words,M=f.words,w=_.words,B=m.words;E=h=I[0],S=d=I[1],T=v=I[2],x=b=I[3],O=N=I[4];for(var k,c=0;c<80;c+=1)k=h+t[e+A[c]]|0,k+=c<16?n(d,v,b)+C[0]:c<32?r(d,v,b)+C[1]:c<48?i(d,v,b)+C[2]:c<64?o(d,v,b)+C[3]:s(d,v,b)+C[4],k|=0,k=a(k,w[c]),k=k+N|0,h=N,N=b,b=a(v,10),v=d,d=k,k=E+t[e+M[c]]|0,k+=c<16?s(S,T,x)+R[0]:c<32?o(S,T,x)+R[1]:c<48?i(S,T,x)+R[2]:c<64?r(S,T,x)+R[3]:n(S,T,x)+R[4],k|=0,k=a(k,B[c]),k=k+O|0,E=O,O=x,x=a(T,10),T=S,S=k;k=I[1]+v+x|0,I[1]=I[2]+b+O|0,I[2]=I[3]+N+E|0,I[3]=I[4]+h+S|0,I[4]=I[0]+d+T|0,I[0]=k},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(e.length+1),this._process();for(var i=this._hash,o=i.words,s=0;s<5;s++){var a=o[s];o[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return i},clone:function(){var t=h.clone.call(this);return t._hash=this._hash.clone(),t}});c.RIPEMD160=h._createHelper(v),c.HmacRIPEMD160=h._createHmacHelper(v)}(Math),t.RIPEMD160})},function(t,e,n){!function(r,i){t.exports=e=i(n(6))}(0,function(t){!function(){var e=t,n=e.lib,r=n.Base,i=e.enc,o=i.Utf8,s=e.algo;s.HMAC=r.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=o.parse(e));var n=t.blockSize,r=4*n;e.sigBytes>r&&(e=t.finalize(e)),e.clamp();for(var i=this._oKey=e.clone(),s=this._iKey=e.clone(),a=i.words,c=s.words,u=0;u<n;u++)a[u]^=1549556828,c[u]^=909522486;i.sigBytes=s.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,n=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(n))}})}()})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(12),n(19))}(0,function(t){return function(){var e=t,n=e.lib,r=n.Base,i=n.WordArray,o=e.algo,s=o.SHA1,a=o.HMAC,c=o.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:s,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var n=this.cfg,r=a.create(n.hasher,t),o=i.create(),s=i.create([1]),c=o.words,u=s.words,l=n.keySize,h=n.iterations;c.length<l;){var d=r.update(e).finalize(s);r.reset();for(var p=d.words,f=p.length,_=d,m=1;m<h;m++){_=r.finalize(_),r.reset();for(var g=_.words,y=0;y<f;y++)p[y]^=g[y]}o.concat(d),u[0]++}return o.sigBytes=4*l,o}});e.PBKDF2=function(t,e,n){return c.create(n).compute(t,e)}}(),t.PBKDF2})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(12),n(19))}(0,function(t){return function(){var e=t,n=e.lib,r=n.Base,i=n.WordArray,o=e.algo,s=o.MD5,a=o.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:s,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var n=this.cfg,r=n.hasher.create(),o=i.create(),s=o.words,a=n.keySize,c=n.iterations;s.length<a;){u&&r.update(u);var u=r.update(t).finalize(e);r.reset();for(var l=1;l<c;l++)u=r.finalize(u),r.reset();o.concat(u)}return o.sigBytes=4*a,o}});e.EvpKDF=function(t,e,n){return a.create(n).compute(t,e)}}(),t.EvpKDF})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(21))}(0,function(t){t.lib.Cipher||function(e){var n=t,r=n.lib,i=r.Base,o=r.WordArray,s=r.BufferedBlockAlgorithm,a=n.enc,c=(a.Utf8,a.Base64),u=n.algo,l=u.EvpKDF,h=r.Cipher=s.extend({cfg:i.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,n){this.cfg=this.cfg.extend(n),this._xformMode=t,this._key=e,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?S:b}return function(e){return{encrypt:function(n,r,i){return t(r).encrypt(e,n,r,i)},decrypt:function(n,r,i){return t(r).decrypt(e,n,r,i)}}}}()}),d=(r.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),n.mode={}),p=r.BlockCipherMode=i.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),f=d.CBC=function(){function t(t,n,r){var i=this._iv;if(i){var o=i;this._iv=e}else var o=this._prevBlock;for(var s=0;s<r;s++)t[n+s]^=o[s]}var n=p.extend();return n.Encryptor=n.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize;t.call(this,e,n,i),r.encryptBlock(e,n),this._prevBlock=e.slice(n,n+i)}}),n.Decryptor=n.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize,o=e.slice(n,n+i);r.decryptBlock(e,n),t.call(this,e,n,i),this._prevBlock=o}}),n}(),_=n.pad={},m=_.Pkcs7={pad:function(t,e){for(var n=4*e,r=n-t.sigBytes%n,i=r<<24|r<<16|r<<8|r,s=[],a=0;a<r;a+=4)s.push(i);var c=o.create(s,r);t.concat(c)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},g=(r.BlockCipher=h.extend({cfg:h.cfg.extend({mode:f,padding:m}),reset:function(){h.reset.call(this);var t=this.cfg,e=t.iv,n=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=n.createEncryptor;else{var r=n.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==r?this._mode.init(this,e&&e.words):(this._mode=r.call(n,this,e&&e.words),this._mode.__creator=r)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else{var e=this._process(!0);t.unpad(e)}return e},blockSize:4}),r.CipherParams=i.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}})),y=n.format={},v=y.OpenSSL={stringify:function(t){var e=t.ciphertext,n=t.salt;if(n)var r=o.create([1398893684,1701076831]).concat(n).concat(e);else var r=e;return r.toString(c)},parse:function(t){var e=c.parse(t),n=e.words;if(1398893684==n[0]&&1701076831==n[1]){var r=o.create(n.slice(2,4));n.splice(0,4),e.sigBytes-=16}return g.create({ciphertext:e,salt:r})}},b=r.SerializableCipher=i.extend({cfg:i.extend({format:v}),encrypt:function(t,e,n,r){r=this.cfg.extend(r);var i=t.createEncryptor(n,r),o=i.finalize(e),s=i.cfg;return g.create({ciphertext:o,key:n,iv:s.iv,algorithm:t,mode:s.mode,padding:s.padding,blockSize:t.blockSize,formatter:r.format})},decrypt:function(t,e,n,r){return r=this.cfg.extend(r),e=this._parse(e,r.format),t.createDecryptor(n,r).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),N=n.kdf={},E=N.OpenSSL={execute:function(t,e,n,r){r||(r=o.random(8));var i=l.create({keySize:e+n}).compute(t,r),s=o.create(i.words.slice(e),4*n);return i.sigBytes=4*e,g.create({key:i,iv:s,salt:r})}},S=r.PasswordBasedCipher=b.extend({cfg:b.cfg.extend({kdf:E}),encrypt:function(t,e,n,r){r=this.cfg.extend(r);var i=r.kdf.execute(n,t.keySize,t.ivSize);r.iv=i.iv;var o=b.encrypt.call(this,t,e,i.key,r);return o.mixIn(i),o},decrypt:function(t,e,n,r){r=this.cfg.extend(r),e=this._parse(e,r.format);var i=r.kdf.execute(n,t.keySize,t.ivSize,e.salt);return r.iv=i.iv,b.decrypt.call(this,t,e,i.key,r)}})}()})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(22))}(0,function(t){return t.mode.CFB=function(){function e(t,e,n,r){var i=this._iv;if(i){var o=i.slice(0);this._iv=void 0}else var o=this._prevBlock;r.encryptBlock(o,0);for(var s=0;s<n;s++)t[e+s]^=o[s]}var n=t.lib.BlockCipherMode.extend();return n.Encryptor=n.extend({processBlock:function(t,n){var r=this._cipher,i=r.blockSize;e.call(this,t,n,i,r),this._prevBlock=t.slice(n,n+i)}}),n.Decryptor=n.extend({processBlock:function(t,n){var r=this._cipher,i=r.blockSize,o=t.slice(n,n+i);e.call(this,t,n,i,r),this._prevBlock=o}}),n}(),t.mode.CFB})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(22))}(0,function(t){return t.mode.CTR=function(){var e=t.lib.BlockCipherMode.extend(),n=e.Encryptor=e.extend({processBlock:function(t,e){var n=this._cipher,r=n.blockSize,i=this._iv,o=this._counter;i&&(o=this._counter=i.slice(0),this._iv=void 0);var s=o.slice(0);n.encryptBlock(s,0),o[r-1]=o[r-1]+1|0;for(var a=0;a<r;a++)t[e+a]^=s[a]}});return e.Decryptor=n,e}(),t.mode.CTR})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(22))}(0,function(t){return t.mode.CTRGladman=function(){function e(t){if(255==(t>>24&255)){var e=t>>16&255,n=t>>8&255,r=255&t;255===e?(e=0,255===n?(n=0,255===r?r=0:++r):++n):++e,t=0,t+=e<<16,t+=n<<8,t+=r}else t+=1<<24;return t}function n(t){return 0===(t[0]=e(t[0]))&&(t[1]=e(t[1])),t}var r=t.lib.BlockCipherMode.extend(),i=r.Encryptor=r.extend({processBlock:function(t,e){var r=this._cipher,i=r.blockSize,o=this._iv,s=this._counter;o&&(s=this._counter=o.slice(0),this._iv=void 0),n(s);var a=s.slice(0);r.encryptBlock(a,0);for(var c=0;c<i;c++)t[e+c]^=a[c]}});return r.Decryptor=i,r}(),t.mode.CTRGladman})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(22))}(0,function(t){return t.mode.OFB=function(){var e=t.lib.BlockCipherMode.extend(),n=e.Encryptor=e.extend({processBlock:function(t,e){var n=this._cipher,r=n.blockSize,i=this._iv,o=this._keystream;i&&(o=this._keystream=i.slice(0),this._iv=void 0),n.encryptBlock(o,0);for(var s=0;s<r;s++)t[e+s]^=o[s]}});return e.Decryptor=n,e}(),t.mode.OFB})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(22))}(0,function(t){return t.mode.ECB=function(){var e=t.lib.BlockCipherMode.extend();return e.Encryptor=e.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),e.Decryptor=e.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),e}(),t.mode.ECB})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(22))}(0,function(t){return t.pad.AnsiX923={pad:function(t,e){var n=t.sigBytes,r=4*e,i=r-n%r,o=n+i-1;t.clamp(),t.words[o>>>2]|=i<<24-o%4*8,t.sigBytes+=i},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},t.pad.Ansix923})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(22))}(0,function(t){return t.pad.Iso10126={pad:function(e,n){var r=4*n,i=r-e.sigBytes%r;e.concat(t.lib.WordArray.random(i-1)).concat(t.lib.WordArray.create([i<<24],1))},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},t.pad.Iso10126})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(22))}(0,function(t){return t.pad.Iso97971={pad:function(e,n){e.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(e,n)},unpad:function(e){t.pad.ZeroPadding.unpad(e),e.sigBytes--}},t.pad.Iso97971})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(22))}(0,function(t){return t.pad.ZeroPadding={pad:function(t,e){var n=4*e;t.clamp(),t.sigBytes+=n-(t.sigBytes%n||n)},unpad:function(t){for(var e=t.words,n=t.sigBytes-1;!(e[n>>>2]>>>24-n%4*8&255);)n--;t.sigBytes=n+1}},t.pad.ZeroPadding})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(22))}(0,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(22))}(0,function(t){return function(e){var n=t,r=n.lib,i=r.CipherParams,o=n.enc,s=o.Hex,a=n.format;a.Hex={stringify:function(t){return t.ciphertext.toString(s)},parse:function(t){var e=s.parse(t);return i.create({ciphertext:e})}}}(),t.format.Hex})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(10),n(11),n(21),n(22))}(0,function(t){return function(){var e=t,n=e.lib,r=n.BlockCipher,i=e.algo,o=[],s=[],a=[],c=[],u=[],l=[],h=[],d=[],p=[],f=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;for(var n=0,r=0,e=0;e<256;e++){var i=r^r<<1^r<<2^r<<3^r<<4;i=i>>>8^255&i^99,o[n]=i,s[i]=n;var _=t[n],m=t[_],g=t[m],y=257*t[i]^16843008*i;a[n]=y<<24|y>>>8,c[n]=y<<16|y>>>16,u[n]=y<<8|y>>>24,l[n]=y;var y=16843009*g^65537*m^257*_^16843008*n;h[i]=y<<24|y>>>8,d[i]=y<<16|y>>>16,p[i]=y<<8|y>>>24,f[i]=y,n?(n=_^t[t[t[g^_]]],r^=t[t[r]]):n=r=1}}();var _=[0,1,2,4,8,16,32,64,128,27,54],m=i.AES=r.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,n=t.sigBytes/4,r=this._nRounds=n+6,i=4*(r+1),s=this._keySchedule=[],a=0;a<i;a++)if(a<n)s[a]=e[a];else{var c=s[a-1];a%n?n>6&&a%n==4&&(c=o[c>>>24]<<24|o[c>>>16&255]<<16|o[c>>>8&255]<<8|o[255&c]):(c=c<<8|c>>>24,c=o[c>>>24]<<24|o[c>>>16&255]<<16|o[c>>>8&255]<<8|o[255&c],c^=_[a/n|0]<<24),s[a]=s[a-n]^c}for(var u=this._invKeySchedule=[],l=0;l<i;l++){var a=i-l;if(l%4)var c=s[a];else var c=s[a-4];u[l]=l<4||a<=4?c:h[o[c>>>24]]^d[o[c>>>16&255]]^p[o[c>>>8&255]]^f[o[255&c]]}}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,a,c,u,l,o)},decryptBlock:function(t,e){var n=t[e+1];t[e+1]=t[e+3],t[e+3]=n,this._doCryptBlock(t,e,this._invKeySchedule,h,d,p,f,s);var n=t[e+1];t[e+1]=t[e+3],t[e+3]=n},_doCryptBlock:function(t,e,n,r,i,o,s,a){for(var c=this._nRounds,u=t[e]^n[0],l=t[e+1]^n[1],h=t[e+2]^n[2],d=t[e+3]^n[3],p=4,f=1;f<c;f++){var _=r[u>>>24]^i[l>>>16&255]^o[h>>>8&255]^s[255&d]^n[p++],m=r[l>>>24]^i[h>>>16&255]^o[d>>>8&255]^s[255&u]^n[p++],g=r[h>>>24]^i[d>>>16&255]^o[u>>>8&255]^s[255&l]^n[p++],y=r[d>>>24]^i[u>>>16&255]^o[l>>>8&255]^s[255&h]^n[p++];u=_,l=m,h=g,d=y}var _=(a[u>>>24]<<24|a[l>>>16&255]<<16|a[h>>>8&255]<<8|a[255&d])^n[p++],m=(a[l>>>24]<<24|a[h>>>16&255]<<16|a[d>>>8&255]<<8|a[255&u])^n[p++],g=(a[h>>>24]<<24|a[d>>>16&255]<<16|a[u>>>8&255]<<8|a[255&l])^n[p++],y=(a[d>>>24]<<24|a[u>>>16&255]<<16|a[l>>>8&255]<<8|a[255&h])^n[p++];t[e]=_,t[e+1]=m,t[e+2]=g,t[e+3]=y},keySize:8});e.AES=r._createHelper(m)}(),t.AES})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(10),n(11),n(21),n(22))}(0,function(t){return function(){function e(t,e){var n=(this._lBlock>>>t^this._rBlock)&e;this._rBlock^=n,this._lBlock^=n<<t}function n(t,e){var n=(this._rBlock>>>t^this._lBlock)&e;this._lBlock^=n,this._rBlock^=n<<t}var r=t,i=r.lib,o=i.WordArray,s=i.BlockCipher,a=r.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],p=a.DES=s.extend({_doReset:function(){for(var t=this._key,e=t.words,n=[],r=0;r<56;r++){var i=c[r]-1;n[r]=e[i>>>5]>>>31-i%32&1}for(var o=this._subKeys=[],s=0;s<16;s++){for(var a=o[s]=[],h=l[s],r=0;r<24;r++)a[r/6|0]|=n[(u[r]-1+h)%28]<<31-r%6,a[4+(r/6|0)]|=n[28+(u[r+24]-1+h)%28]<<31-r%6;a[0]=a[0]<<1|a[0]>>>31;for(var r=1;r<7;r++)a[r]=a[r]>>>4*(r-1)+3;a[7]=a[7]<<5|a[7]>>>27}for(var d=this._invSubKeys=[],r=0;r<16;r++)d[r]=o[15-r]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(t,r,i){this._lBlock=t[r],this._rBlock=t[r+1],e.call(this,4,252645135),e.call(this,16,65535),n.call(this,2,858993459),n.call(this,8,16711935),e.call(this,1,1431655765);for(var o=0;o<16;o++){for(var s=i[o],a=this._lBlock,c=this._rBlock,u=0,l=0;l<8;l++)u|=h[l][((c^s[l])&d[l])>>>0];this._lBlock=c,this._rBlock=a^u}var p=this._lBlock;this._lBlock=this._rBlock,this._rBlock=p,e.call(this,1,1431655765),
n.call(this,8,16711935),n.call(this,2,858993459),e.call(this,16,65535),e.call(this,4,252645135),t[r]=this._lBlock,t[r+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});r.DES=s._createHelper(p);var f=a.TripleDES=s.extend({_doReset:function(){var t=this._key,e=t.words;this._des1=p.createEncryptor(o.create(e.slice(0,2))),this._des2=p.createEncryptor(o.create(e.slice(2,4))),this._des3=p.createEncryptor(o.create(e.slice(4,6)))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2});r.TripleDES=s._createHelper(f)}(),t.TripleDES})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(10),n(11),n(21),n(22))}(0,function(t){return function(){function e(){for(var t=this._S,e=this._i,n=this._j,r=0,i=0;i<4;i++){e=(e+1)%256,n=(n+t[e])%256;var o=t[e];t[e]=t[n],t[n]=o,r|=t[(t[e]+t[n])%256]<<24-8*i}return this._i=e,this._j=n,r}var n=t,r=n.lib,i=r.StreamCipher,o=n.algo,s=o.RC4=i.extend({_doReset:function(){for(var t=this._key,e=t.words,n=t.sigBytes,r=this._S=[],i=0;i<256;i++)r[i]=i;for(var i=0,o=0;i<256;i++){var s=i%n,a=e[s>>>2]>>>24-s%4*8&255;o=(o+r[i]+a)%256;var c=r[i];r[i]=r[o],r[o]=c}this._i=this._j=0},_doProcessBlock:function(t,n){t[n]^=e.call(this)},keySize:8,ivSize:0});n.RC4=i._createHelper(s);var a=o.RC4Drop=s.extend({cfg:s.cfg.extend({drop:192}),_doReset:function(){s._doReset.call(this);for(var t=this.cfg.drop;t>0;t--)e.call(this)}});n.RC4Drop=i._createHelper(a)}(),t.RC4})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(10),n(11),n(21),n(22))}(0,function(t){return function(){function e(){for(var t=this._X,e=this._C,n=0;n<8;n++)a[n]=e[n];e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<a[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<a[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<a[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<a[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<a[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<a[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<a[6]>>>0?1:0)|0,this._b=e[7]>>>0<a[7]>>>0?1:0;for(var n=0;n<8;n++){var r=t[n]+e[n],i=65535&r,o=r>>>16,s=((i*i>>>17)+i*o>>>15)+o*o,u=((4294901760&r)*r|0)+((65535&r)*r|0);c[n]=s^u}t[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,t[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,t[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,t[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,t[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,t[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,t[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,t[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}var n=t,r=n.lib,i=r.StreamCipher,o=n.algo,s=[],a=[],c=[],u=o.Rabbit=i.extend({_doReset:function(){for(var t=this._key.words,n=this.cfg.iv,r=0;r<4;r++)t[r]=16711935&(t[r]<<8|t[r]>>>24)|4278255360&(t[r]<<24|t[r]>>>8);var i=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],o=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];this._b=0;for(var r=0;r<4;r++)e.call(this);for(var r=0;r<8;r++)o[r]^=i[r+4&7];if(n){var s=n.words,a=s[0],c=s[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),h=u>>>16|4294901760&l,d=l<<16|65535&u;o[0]^=u,o[1]^=h,o[2]^=l,o[3]^=d,o[4]^=u,o[5]^=h,o[6]^=l,o[7]^=d;for(var r=0;r<4;r++)e.call(this)}},_doProcessBlock:function(t,n){var r=this._X;e.call(this),s[0]=r[0]^r[5]>>>16^r[3]<<16,s[1]=r[2]^r[7]>>>16^r[5]<<16,s[2]=r[4]^r[1]>>>16^r[7]<<16,s[3]=r[6]^r[3]>>>16^r[1]<<16;for(var i=0;i<4;i++)s[i]=16711935&(s[i]<<8|s[i]>>>24)|4278255360&(s[i]<<24|s[i]>>>8),t[n+i]^=s[i]},blockSize:4,ivSize:2});n.Rabbit=i._createHelper(u)}(),t.Rabbit})},function(t,e,n){!function(r,i,o){t.exports=e=i(n(6),n(10),n(11),n(21),n(22))}(0,function(t){return function(){function e(){for(var t=this._X,e=this._C,n=0;n<8;n++)a[n]=e[n];e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<a[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<a[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<a[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<a[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<a[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<a[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<a[6]>>>0?1:0)|0,this._b=e[7]>>>0<a[7]>>>0?1:0;for(var n=0;n<8;n++){var r=t[n]+e[n],i=65535&r,o=r>>>16,s=((i*i>>>17)+i*o>>>15)+o*o,u=((4294901760&r)*r|0)+((65535&r)*r|0);c[n]=s^u}t[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,t[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,t[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,t[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,t[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,t[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,t[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,t[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}var n=t,r=n.lib,i=r.StreamCipher,o=n.algo,s=[],a=[],c=[],u=o.RabbitLegacy=i.extend({_doReset:function(){var t=this._key.words,n=this.cfg.iv,r=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],i=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];this._b=0;for(var o=0;o<4;o++)e.call(this);for(var o=0;o<8;o++)i[o]^=r[o+4&7];if(n){var s=n.words,a=s[0],c=s[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),h=u>>>16|4294901760&l,d=l<<16|65535&u;i[0]^=u,i[1]^=h,i[2]^=l,i[3]^=d,i[4]^=u,i[5]^=h,i[6]^=l,i[7]^=d;for(var o=0;o<4;o++)e.call(this)}},_doProcessBlock:function(t,n){var r=this._X;e.call(this),s[0]=r[0]^r[5]>>>16^r[3]<<16,s[1]=r[2]^r[7]>>>16^r[5]<<16,s[2]=r[4]^r[1]>>>16^r[7]<<16,s[3]=r[6]^r[3]>>>16^r[1]<<16;for(var i=0;i<4;i++)s[i]=16711935&(s[i]<<8|s[i]>>>24)|4278255360&(s[i]<<24|s[i]>>>8),t[n+i]^=s[i]},blockSize:4,ivSize:2});n.RabbitLegacy=i._createHelper(u)}(),t.RabbitLegacy})},function(t,e){!function(){function t(t){this.array=void 0===t?[]:new Array(t)}t.prototype={length:function(){return this.array.length},at:function(t){return this.array[t]},set:function(t,e){this.array[t]=e},push:function(t){return this.array.push(t)},slice:function(t,e){return this.array=this.array.slice(t,e)},concat:function(t){this.array=this.array.concat(t)},remove:function(t,e){e=void 0===e?1:e,this.array.splice(t,e)},join:function(t){return this.array.join(t)},clear:function(){this.array.length=0}};var n=function(){this._array_h=new t};n.prototype={_index:0,push:function(t){this._array_h.push(t)},pop:function(){var t=null;return this._array_h.length()&&(t=this._array_h.at(this._index),2*++this._index>=this._array_h.length()&&(this._array_h.slice(this._index),this._index=0)),t},head:function(){var t=null,e=this._array_h.length();return e&&(t=this._array_h.at(e-1)),t},tail:function(){var t=null;return this._array_h.length()&&(t=this._array_h.at(this._index)),t},length:function(){return this._array_h.length()-this._index},empty:function(){return 0===this._array_h.length()},clear:function(){this._array_h.clear()}},e.Queue=n}()},function(t,e,n){var r,i,o;!function(n,s){i=[],r=s,void 0!==(o="function"==typeof r?r.apply(e,i):r)&&(t.exports=o)}(0,function(){var t,e,n;return function(r){function i(t,e){return N.call(t,e)}function o(t,e){var n,r,i,o,s,a,c,u,l,h,d,p,f=e&&e.split("/"),_=v.map,m=_&&_["*"]||{};if(t){for(t=t.split("/"),s=t.length-1,v.nodeIdCompat&&S.test(t[s])&&(t[s]=t[s].replace(S,"")),"."===t[0].charAt(0)&&f&&(p=f.slice(0,f.length-1),t=p.concat(t)),l=0;l<t.length;l++)if("."===(d=t[l]))t.splice(l,1),l-=1;else if(".."===d){if(0===l||1===l&&".."===t[2]||".."===t[l-1])continue;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}if((f||m)&&_){for(n=t.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),f)for(h=f.length;h>0;h-=1)if((i=_[f.slice(0,h).join("/")])&&(i=i[r])){o=i,a=l;break}if(o)break;!c&&m&&m[r]&&(c=m[r],u=l)}!o&&c&&(o=c,a=u),o&&(n.splice(0,a,o),t=n.join("/"))}return t}function s(t,e){return function(){var n=E.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),f.apply(r,n.concat([t,e]))}}function a(t){return function(e){return o(e,t)}}function c(t){return function(e){g[t]=e}}function u(t){if(i(y,t)){var e=y[t];delete y[t],b[t]=!0,p.apply(r,e)}if(!i(g,t)&&!i(b,t))throw new Error("No "+t);return g[t]}function l(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function h(t){return t?l(t):[]}function d(t){return function(){return v&&v.config&&v.config[t]||{}}}var p,f,_,m,g={},y={},v={},b={},N=Object.prototype.hasOwnProperty,E=[].slice,S=/\.js$/;_=function(t,e){var n,r=l(t),i=r[0],s=e[1];return t=r[1],i&&(i=o(i,s),n=u(i)),i?t=n&&n.normalize?n.normalize(t,a(s)):o(t,s):(t=o(t,s),r=l(t),i=r[0],t=r[1],i&&(n=u(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:n}},m={require:function(t){return s(t)},exports:function(t){var e=g[t];return void 0!==e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:d(t)}}},p=function(t,e,n,o){var a,l,d,p,f,v,N,E=[],S=void 0===n?"undefined":_typeof(n);if(o=o||t,v=h(o),"undefined"===S||"function"===S){for(e=!e.length&&n.length?["require","exports","module"]:e,f=0;f<e.length;f+=1)if(p=_(e[f],v),"require"===(l=p.f))E[f]=m.require(t);else if("exports"===l)E[f]=m.exports(t),N=!0;else if("module"===l)a=E[f]=m.module(t);else if(i(g,l)||i(y,l)||i(b,l))E[f]=u(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,s(o,!0),c(l),{}),E[f]=g[l]}d=n?n.apply(g[t],E):void 0,t&&(a&&a.exports!==r&&a.exports!==g[t]?g[t]=a.exports:d===r&&N||(g[t]=d))}else t&&(g[t]=n)},t=e=f=function(t,e,n,i,o){if("string"==typeof t)return m[t]?m[t](e):u(_(t,h(e)).f);if(!t.splice){if(v=t,v.deps&&f(v.deps,v.callback),!e)return;e.splice?(t=e,e=n,n=null):t=r}return e=e||function(){},"function"==typeof n&&(n=i,i=o),i?p(r,t,e,n):setTimeout(function(){p(r,t,e,n)},4),f},f.config=function(t){return f(t)},t._defined=g,n=function(t,e,n){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(n=e,e=[]),i(g,t)||i(y,t)||(y[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("node_modules/almond/almond.js",function(){}),function(t,e){if("function"!=typeof n||!n.amd)return e(t);n("strophe-polyfill",[],function(){return e(t)})}(this,function(t){Function.prototype.bind||(Function.prototype.bind=function(t){var e=this,n=Array.prototype.slice,r=Array.prototype.concat,i=n.call(arguments,1);return function(){return e.apply(t||this,r.call(i,n.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=e);n<e;n++)if(n in this&&this[n]===t)return n;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,r;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),r=0;r<o;){var s;r in i&&(s=i[r],t.call(n,s,r,i)),r++}});var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.btoa||(t.btoa=function(t){var n,r,i,o,s,a,c,u="",l=0;do{n=t.charCodeAt(l++),r=t.charCodeAt(l++),i=t.charCodeAt(l++),o=n>>2,s=(3&n)<<4|r>>4,a=(15&r)<<2|i>>6,c=63&i,isNaN(r)?(s=(3&n)<<4,a=c=64):isNaN(i)&&(c=64),u=u+e.charAt(o)+e.charAt(s)+e.charAt(a)+e.charAt(c)}while(l<t.length);return u}),t.atob||(t.atob=function(t){var n,r,i,o,s,a,c,u="",l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{o=e.indexOf(t.charAt(l++)),s=e.indexOf(t.charAt(l++)),a=e.indexOf(t.charAt(l++)),c=e.indexOf(t.charAt(l++)),n=o<<2|s>>4,r=(15&s)<<4|a>>2,i=(3&a)<<6|c,u+=String.fromCharCode(n),64!==a&&(u+=String.fromCharCode(r)),64!==c&&(u+=String.fromCharCode(i))}while(l<t.length);return u})}),function(t,e){"function"==typeof n&&n.amd?n("strophe-sha1",[],function(){return e()}):t.SHA1=e()}(this,function(){function t(t,r){t[r>>5]|=128<<24-r%32,t[15+(r+64>>9<<4)]=r;var s,a,c,u,l,h,d,p,f=new Array(80),_=1732584193,m=-271733879,g=-1732584194,y=271733878,v=-1009589776;for(s=0;s<t.length;s+=16){for(u=_,l=m,h=g,d=y,p=v,a=0;a<80;a++)f[a]=a<16?t[s+a]:o(f[a-3]^f[a-8]^f[a-14]^f[a-16],1),c=i(i(o(_,5),e(a,m,g,y)),i(i(v,f[a]),n(a))),v=y,y=g,g=o(m,30),m=_,_=c;_=i(_,u),m=i(m,l),g=i(g,h),y=i(y,d),v=i(v,p)}return[_,m,g,y,v]}function e(t,e,n,r){return t<20?e&n|~e&r:t<40?e^n^r:t<60?e&n|e&r|n&r:e^n^r}function n(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function r(e,n){var r=s(e);r.length>16&&(r=t(r,8*e.length));for(var i=new Array(16),o=new Array(16),a=0;a<16;a++)i[a]=909522486^r[a],o[a]=1549556828^r[a];var c=t(i.concat(s(n)),512+8*n.length);return t(o.concat(c),672)}function i(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function o(t,e){return t<<e|t>>>32-e}function s(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}function a(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>24-n%32&255);return e}function c(t){for(var e,n,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="",o=0;o<4*t.length;o+=3)for(e=(t[o>>2]>>8*(3-o%4)&255)<<16|(t[o+1>>2]>>8*(3-(o+1)%4)&255)<<8|t[o+2>>2]>>8*(3-(o+2)%4)&255,n=0;n<4;n++)8*o+6*n>32*t.length?i+="=":i+=r.charAt(e>>6*(3-n)&63);return i}return{b64_hmac_sha1:function(t,e){return c(r(t,e))},b64_sha1:function(e){return c(t(s(e),8*e.length))},binb2str:a,core_hmac_sha1:r,str_hmac_sha1:function(t,e){return a(r(t,e))},str_sha1:function(e){return a(t(s(e),8*e.length))}}}),function(t,e){"function"==typeof n&&n.amd?n("strophe-md5",[],function(){return e()}):t.MD5=e()}(this,function(){var t=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n},e=function(t,e){return t<<e|t>>>32-e},n=function(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},r=function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e},i=function(t){for(var e="0123456789abcdef",n="",r=0;r<4*t.length;r++)n+=e.charAt(t[r>>2]>>r%4*8+4&15)+e.charAt(t[r>>2]>>r%4*8&15);return n},o=function(n,r,i,o,s,a){return t(e(t(t(r,n),t(o,a)),s),i)},s=function(t,e,n,r,i,s,a){return o(e&n|~e&r,t,e,i,s,a)},a=function(t,e,n,r,i,s,a){return o(e&r|n&~r,t,e,i,s,a)},c=function(t,e,n,r,i,s,a){return o(e^n^r,t,e,i,s,a)},u=function(t,e,n,r,i,s,a){return o(n^(e|~r),t,e,i,s,a)},l=function(e,n){e[n>>5]|=128<<n%32,e[14+(n+64>>>9<<4)]=n;for(var r,i,o,l,h=1732584193,d=-271733879,p=-1732584194,f=271733878,_=0;_<e.length;_+=16)r=h,i=d,o=p,l=f,h=s(h,d,p,f,e[_+0],7,-680876936),f=s(f,h,d,p,e[_+1],12,-389564586),p=s(p,f,h,d,e[_+2],17,606105819),d=s(d,p,f,h,e[_+3],22,-1044525330),h=s(h,d,p,f,e[_+4],7,-176418897),f=s(f,h,d,p,e[_+5],12,1200080426),p=s(p,f,h,d,e[_+6],17,-1473231341),d=s(d,p,f,h,e[_+7],22,-45705983),h=s(h,d,p,f,e[_+8],7,1770035416),f=s(f,h,d,p,e[_+9],12,-1958414417),p=s(p,f,h,d,e[_+10],17,-42063),d=s(d,p,f,h,e[_+11],22,-1990404162),h=s(h,d,p,f,e[_+12],7,1804603682),f=s(f,h,d,p,e[_+13],12,-40341101),p=s(p,f,h,d,e[_+14],17,-1502002290),d=s(d,p,f,h,e[_+15],22,1236535329),h=a(h,d,p,f,e[_+1],5,-165796510),f=a(f,h,d,p,e[_+6],9,-1069501632),p=a(p,f,h,d,e[_+11],14,643717713),d=a(d,p,f,h,e[_+0],20,-373897302),h=a(h,d,p,f,e[_+5],5,-701558691),f=a(f,h,d,p,e[_+10],9,38016083),p=a(p,f,h,d,e[_+15],14,-660478335),d=a(d,p,f,h,e[_+4],20,-405537848),h=a(h,d,p,f,e[_+9],5,568446438),f=a(f,h,d,p,e[_+14],9,-1019803690),p=a(p,f,h,d,e[_+3],14,-187363961),d=a(d,p,f,h,e[_+8],20,1163531501),h=a(h,d,p,f,e[_+13],5,-1444681467),f=a(f,h,d,p,e[_+2],9,-51403784),p=a(p,f,h,d,e[_+7],14,1735328473),d=a(d,p,f,h,e[_+12],20,-1926607734),h=c(h,d,p,f,e[_+5],4,-378558),f=c(f,h,d,p,e[_+8],11,-2022574463),p=c(p,f,h,d,e[_+11],16,1839030562),d=c(d,p,f,h,e[_+14],23,-35309556),h=c(h,d,p,f,e[_+1],4,-1530992060),f=c(f,h,d,p,e[_+4],11,1272893353),p=c(p,f,h,d,e[_+7],16,-155497632),d=c(d,p,f,h,e[_+10],23,-1094730640),h=c(h,d,p,f,e[_+13],4,681279174),f=c(f,h,d,p,e[_+0],11,-358537222),p=c(p,f,h,d,e[_+3],16,-722521979),d=c(d,p,f,h,e[_+6],23,76029189),h=c(h,d,p,f,e[_+9],4,-640364487),f=c(f,h,d,p,e[_+12],11,-421815835),p=c(p,f,h,d,e[_+15],16,530742520),d=c(d,p,f,h,e[_+2],23,-995338651),h=u(h,d,p,f,e[_+0],6,-198630844),f=u(f,h,d,p,e[_+7],10,1126891415),p=u(p,f,h,d,e[_+14],15,-1416354905),d=u(d,p,f,h,e[_+5],21,-57434055),h=u(h,d,p,f,e[_+12],6,1700485571),f=u(f,h,d,p,e[_+3],10,-1894986606),p=u(p,f,h,d,e[_+10],15,-1051523),d=u(d,p,f,h,e[_+1],21,-2054922799),h=u(h,d,p,f,e[_+8],6,1873313359),f=u(f,h,d,p,e[_+15],10,-30611744),p=u(p,f,h,d,e[_+6],15,-1560198380),d=u(d,p,f,h,e[_+13],21,1309151649),h=u(h,d,p,f,e[_+4],6,-145523070),f=u(f,h,d,p,e[_+11],10,-1120210379),p=u(p,f,h,d,e[_+2],15,718787259),d=u(d,p,f,h,e[_+9],21,-343485551),h=t(h,r),d=t(d,i),p=t(p,o),f=t(f,l);return[h,d,p,f]};return{hexdigest:function(t){return i(l(n(t),8*t.length))},hash:function(t){return r(l(n(t),8*t.length))}}}),function(t,e){"function"==typeof n&&n.amd?n("strophe-utils",[],function(){return e()}):t.stropheUtils=e()}(this,function(){return{utf16to8:function(t){var e,n,r="",i=t.length;for(e=0;e<i;e++)n=t.charCodeAt(e),n>=0&&n<=127?r+=t.charAt(e):n>2047?(r+=String.fromCharCode(224|n>>12&15),r+=String.fromCharCode(128|n>>6&63),r+=String.fromCharCode(128|n>>0&63)):(r+=String.fromCharCode(192|n>>6&31),r+=String.fromCharCode(128|n>>0&63));return r},addCookies:function(t){var e,n,r,i,o,s,a;for(e in t||{})o="",s="",a="",n=t[e],r="object"===(void 0===n?"undefined":_typeof(n)),i=escape(unescape(r?n.value:n)),r&&(o=n.expires?";expires="+n.expires:"",s=n.domain?";domain="+n.domain:"",a=n.path?";path="+n.path:""),document.cookie=e+"="+i+o+s+a}}}),function(t,e){if("function"==typeof n&&n.amd)n("strophe-core",["strophe-sha1","strophe-md5","strophe-utils"],function(){return e.apply(this,arguments)});else{var r=e(t.SHA1,t.MD5,t.stropheUtils);t.Strophe=r.Strophe,t.$build=r.$build,t.$iq=r.$iq,t.$msg=r.$msg,t.$pres=r.$pres,t.SHA1=r.SHA1,t.MD5=r.MD5,t.b64_hmac_sha1=r.SHA1.b64_hmac_sha1,t.b64_sha1=r.SHA1.b64_sha1,t.str_hmac_sha1=r.SHA1.str_hmac_sha1,t.str_sha1=r.SHA1.str_sha1}}(this,function(t,e,n){function r(t,e){return new a.Builder(t,e)}function i(t){return new a.Builder("message",t)}function o(t){return new a.Builder("iq",t)}function s(t){return new a.Builder("presence",t)}var a;return a={VERSION:"1.2.14",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(t){for(var e=0;e<a.XHTML.tags.length;e++)if(t===a.XHTML.tags[e])return!0;return!1},validAttribute:function(t,e){if(void 0!==a.XHTML.attributes[t]&&a.XHTML.attributes[t].length>0)for(var n=0;n<a.XHTML.attributes[t].length;n++)if(e===a.XHTML.attributes[t][n])return!0;return!1},validCSS:function(t){for(var e=0;e<a.XHTML.css.length;e++)if(t===a.XHTML.css[e])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(t,e){a.NS[t]=e},forEachChild:function(t,e,n){var r,i;for(r=0;r<t.childNodes.length;r++)i=t.childNodes[r],i.nodeType!==a.ElementType.NORMAL||e&&!this.isTagEqual(i,e)||n(i)},isTagEqual:function(t,e){return t.tagName===e},_xmlGenerator:null,_makeGenerator:function(){var t;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(t=this._getIEXmlDom(),t.appendChild(t.createElement("strophe"))):t=document.implementation.createDocument("jabber:client","strophe",null),t},xmlGenerator:function(){return a._xmlGenerator||(a._xmlGenerator=a._makeGenerator()),a._xmlGenerator},_getIEXmlDom:function(){for(var t=null,e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<e.length&&null===t;n++)try{t=new ActiveXObject(e[n])}catch(e){t=null}return t},xmlElement:function(t){if(!t)return null;var e,n,r,i=a.xmlGenerator().createElement(t);for(e=1;e<arguments.length;e++){var o=arguments[e];if(o)if("string"==typeof o||"number"==typeof o)i.appendChild(a.xmlTextNode(o));else if("object"===(void 0===o?"undefined":_typeof(o))&&"function"==typeof o.sort)for(n=0;n<o.length;n++){var s=o[n];"object"===(void 0===s?"undefined":_typeof(s))&&"function"==typeof s.sort&&void 0!==s[1]&&null!==s[1]&&i.setAttribute(s[0],s[1])}else if("object"===(void 0===o?"undefined":_typeof(o)))for(r in o)o.hasOwnProperty(r)&&void 0!==o[r]&&null!==o[r]&&i.setAttribute(r,o[r])}return i},xmlescape:function(t){return t=t.replace(/\&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/'/g,"&apos;"),t=t.replace(/"/g,"&quot;")},xmlunescape:function(t){return t=t.replace(/\&amp;/g,"&"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&apos;/g,"'"),t=t.replace(/&quot;/g,'"')},xmlTextNode:function(t){return a.xmlGenerator().createTextNode(t)},xmlHtmlNode:function(t){var e;if(DOMParser){e=(new DOMParser).parseFromString(t,"text/xml")}else e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t);return e},getText:function(t){if(!t)return null;var e="";0===t.childNodes.length&&t.nodeType===a.ElementType.TEXT&&(e+=t.nodeValue);for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType===a.ElementType.TEXT&&(e+=t.childNodes[n].nodeValue);return a.xmlescape(e)},copyElement:function(t){var e,n;if(t.nodeType===a.ElementType.NORMAL){for(n=a.xmlElement(t.tagName),e=0;e<t.attributes.length;e++)n.setAttribute(t.attributes[e].nodeName,t.attributes[e].value);for(e=0;e<t.childNodes.length;e++)n.appendChild(a.copyElement(t.childNodes[e]))}else t.nodeType===a.ElementType.TEXT&&(n=a.xmlGenerator().createTextNode(t.nodeValue));return n},createHtml:function(t){var e,n,r,i,o,s,c,u,l,h,d;if(t.nodeType===a.ElementType.NORMAL)if(i=t.nodeName.toLowerCase(),a.XHTML.validTag(i))try{for(n=a.xmlElement(i),e=0;e<a.XHTML.attributes[i].length;e++)if(o=a.XHTML.attributes[i][e],void 0!==(s=t.getAttribute(o))&&null!==s&&""!==s&&!1!==s&&0!==s)if("style"===o&&"object"===(void 0===s?"undefined":_typeof(s))&&void 0!==s.cssText&&(s=s.cssText),"style"===o){for(c=[],u=s.split(";"),r=0;r<u.length;r++)l=u[r].split(":"),h=l[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),a.XHTML.validCSS(h)&&(d=l[1].replace(/^\s*/,"").replace(/\s*$/,""),c.push(h+": "+d));c.length>0&&(s=c.join("; "),n.setAttribute(o,s))}else n.setAttribute(o,s);for(e=0;e<t.childNodes.length;e++)n.appendChild(a.createHtml(t.childNodes[e]))}catch(t){n=a.xmlTextNode("")}else for(n=a.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(a.createHtml(t.childNodes[e]));else if(t.nodeType===a.ElementType.FRAGMENT)for(n=a.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(a.createHtml(t.childNodes[e]));else t.nodeType===a.ElementType.TEXT&&(n=a.xmlTextNode(t.nodeValue));return n},escapeNode:function(t){return"string"!=typeof t?t:t.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(t){return"string"!=typeof t?t:t.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(t){return t.indexOf("@")<0?null:t.split("@")[0]},getDomainFromJid:function(t){var e=a.getBareJidFromJid(t);if(e.indexOf("@")<0)return e;var n=e.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(t){var e=t.split("/");return e.length<2?null:(e.splice(0,1),e.join("/"))},getBareJidFromJid:function(t){return t?t.split("/")[0]:null},_handleError:function(t){void 0!==t.stack&&a.fatal(t.stack),t.sourceURL?a.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?a.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message):a.fatal("error: "+t.message)},log:function(t,e){},debug:function(t){this.log(this.LogLevel.DEBUG,t)},info:function(t){this.log(this.LogLevel.INFO,t)},warn:function(t){this.log(this.LogLevel.WARN,t)},error:function(t){this.log(this.LogLevel.ERROR,t)},fatal:function(t){this.log(this.LogLevel.FATAL,t)},serialize:function(t){var e;if(!t)return null;"function"==typeof t.tree&&(t=t.tree());var n,r,i=t.nodeName;for(t.getAttribute("_realname")&&(i=t.getAttribute("_realname")),e="<"+i,n=0;n<t.attributes.length;n++)"_realname"!==t.attributes[n].nodeName&&(e+=" "+t.attributes[n].nodeName+"='"+a.xmlescape(t.attributes[n].value)+"'");if(t.childNodes.length>0){for(e+=">",n=0;n<t.childNodes.length;n++)switch(r=t.childNodes[n],r.nodeType){case a.ElementType.NORMAL:e+=a.serialize(r);break;case a.ElementType.TEXT:e+=a.xmlescape(r.nodeValue);break;case a.ElementType.CDATA:e+="<![CDATA["+r.nodeValue+"]]>"}e+="</"+i+">"}else e+="/>";return e},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(t,e){a._connectionPlugins[t]=e}},a.Builder=function(t,e){"presence"!==t&&"message"!==t&&"iq"!==t||(e&&!e.xmlns?e.xmlns=a.NS.CLIENT:e||(e={xmlns:a.NS.CLIENT})),this.nodeTree=a.xmlElement(t,e),this.node=this.nodeTree},a.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return a.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(t){for(var e in t)t.hasOwnProperty(e)&&(void 0===t[e]?this.node.removeAttribute(e):this.node.setAttribute(e,t[e]));return this},c:function(t,e,n){var r=a.xmlElement(t,e,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this},cnode:function(t){var e,n=a.xmlGenerator();try{e=void 0!==n.importNode}catch(t){e=!1}var r=e?n.importNode(t,!0):a.copyElement(t);return this.node.appendChild(r),this.node=r,this},t:function(t){var e=a.xmlTextNode(t);return this.node.appendChild(e),this},h:function(t){var e=document.createElement("body");e.innerHTML=t;for(var n=a.createHtml(e);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},a.Handler=function(t,e,n,r,i,o,s){this.handler=t,this.ns=e,this.name=n,this.type=r,this.id=i,this.options=s||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(a.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?a.getBareJidFromJid(o):null:this.from=o,this.user=!0},a.Handler.prototype={getNamespace:function(t){var e=t.getAttribute("xmlns");return e&&this.options.ignoreNamespaceFragment&&(e=e.split("#")[0]),e},namespaceMatch:function(t){var e=!1;if(!this.ns)return!0;var n=this;return a.forEachChild(t,null,function(t){n.getNamespace(t)===n.ns&&(e=!0)}),e=e||this.getNamespace(t)===this.ns},isMatch:function(t){var e=t.getAttribute("from");this.options.matchBareFromJid&&(e=a.getBareJidFromJid(e));var n=t.getAttribute("type");return!(!this.namespaceMatch(t)||this.name&&!a.isTagEqual(t,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&t.getAttribute("id")!==this.id||this.from&&e!==this.from)},run:function(t){var e=null;try{e=this.handler(t)}catch(t){throw a._handleError(t),t}return e},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},a.TimedHandler=function(t,e){this.period=t,this.handler=e,this.lastCalled=(new Date).getTime(),this.user=!0},a.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},a.Connection=function(t,e){this.service=t,this.options=e||{};var r=this.options.protocol||"";0===t.indexOf("ws:")||0===t.indexOf("wss:")||0===r.indexOf("ws")?this._proto=new a.Websocket(this):this._proto=new a.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),n.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms);for(var i in a._connectionPlugins)if(a._connectionPlugins.hasOwnProperty(i)){var o=a._connectionPlugins[i],s=function(){};s.prototype=o,this[i]=new s,this[i].init(this)}},a.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(t){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)});return"string"==typeof t||"number"==typeof t?e+":"+t:e+""},addProtocolErrorHandler:function(t,e,n){this.protocolErrorHandlers[t][e]=n},connect:function(t,e,n,r,i,o,s){this.jid=t,this.authzid=a.getBareJidFromJid(this.jid),this.authcid=s||a.getNodeFromJid(this.jid),this.pass=e,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=a.getDomainFromJid(this.jid),this._changeConnectStatus(a.Status.CONNECTING,null),this._proto._connect(r,i,o)},attach:function(t,e,n,r,i,o,s){if(!(this._proto instanceof a.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(t,e,n,r,i,o,s)},restore:function(t,e,n,r,i){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(t,e,n,r,i)},_sessionCachingSupported:function(){if(this._proto instanceof a.Bosh){if(!JSON)return!1;try{
sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(t){},xmlOutput:function(t){},rawInput:function(t){},rawOutput:function(t){},nextValidRid:function(t){},send:function(t){if(null!==t){if("function"==typeof t.sort)for(var e=0;e<t.length;e++)this._queueData(t[e]);else"function"==typeof t.tree?this._queueData(t.tree()):this._queueData(t);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(t,e,n,r){var i=null,o=this;"function"==typeof t.tree&&(t=t.tree());var s=t.getAttribute("id");if(s||(s=this.getUniqueId("sendPresence"),t.setAttribute("id",s)),"function"==typeof e||"function"==typeof n){var a=this.addHandler(function(t){i&&o.deleteTimedHandler(i),"error"===t.getAttribute("type")?n&&n(t):e&&e(t)},null,"presence",null,s);r&&(i=this.addTimedHandler(r,function(){return o.deleteHandler(a),n&&n(null),!1}))}return this.send(t),s},sendIQ:function(t,e,n,r){var i=null,o=this;"function"==typeof t.tree&&(t=t.tree());var s=t.getAttribute("id");if(s||(s=this.getUniqueId("sendIQ"),t.setAttribute("id",s)),"function"==typeof e||"function"==typeof n){var a=this.addHandler(function(t){i&&o.deleteTimedHandler(i);var r=t.getAttribute("type");if("result"===r)e&&e(t);else{if("error"!==r)throw{name:"StropheError",message:"Got bad IQ type of "+r};n&&n(t)}},null,"iq",["error","result"],s);r&&(i=this.addTimedHandler(r,function(){return o.deleteHandler(a),n&&n(null),!1}))}return this.send(t),s},_queueData:function(t){if(null===t||!t.tagName||!t.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(t)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(t,e){var n=new a.TimedHandler(t,e);return this.addTimeds.push(n),n},deleteTimedHandler:function(t){this.removeTimeds.push(t)},addHandler:function(t,e,n,r,i,o,s){var c=new a.Handler(t,e,n,r,i,o,s);return this.addHandlers.push(c),c},deleteHandler:function(t){this.removeHandlers.push(t);var e=this.addHandlers.indexOf(t);e>=0&&this.addHandlers.splice(e,1)},registerSASLMechanisms:function(t){this.mechanisms={},t=t||[a.SASLAnonymous,a.SASLExternal,a.SASLMD5,a.SASLOAuthBearer,a.SASLPlain,a.SASLSHA1],t.forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(t){this.mechanisms[t.prototype.name]=t},disconnect:function(t){if(this._changeConnectStatus(a.Status.DISCONNECTING,t),a.info("Disconnect was called because: "+t),this.connected){var e=!1;this.disconnecting=!0,this.authenticated&&(e=s({xmlns:a.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else a.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(t,e){for(var n in a._connectionPlugins)if(a._connectionPlugins.hasOwnProperty(n)){var r=this[n];if(r.statusChanged)try{r.statusChanged(t,e)}catch(t){a.error(n+" plugin caused an exception changing status: "+t)}}if(this.connect_callback)try{this.connect_callback(t,e)}catch(t){a._handleError(t),a.error("User connection callback caused an exception: "+t)}},_doDisconnect:function(t){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),a.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(a.Status.DISCONNECTED,t),this.connected=!1},_dataRecv:function(t,e){a.info("_dataRecv called");var n=this._proto._reqToData(t);if(null!==n){this.xmlInput!==a.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==a.Connection.prototype.rawInput&&(e?this.rawInput(e):this.rawInput(a.serialize(n)));for(var r,i;this.removeHandlers.length>0;)i=this.removeHandlers.pop(),(r=this.handlers.indexOf(i))>=0&&this.handlers.splice(r,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var o,s,c=n.getAttribute("type");if(null!==c&&"terminate"===c){if(this.disconnecting)return;return o=n.getAttribute("condition"),s=n.getElementsByTagName("conflict"),null!==o?("remote-stream-error"===o&&s.length>0&&(o="conflict"),this._changeConnectStatus(a.Status.CONNFAIL,o)):this._changeConnectStatus(a.Status.CONNFAIL,"unknown"),void this._doDisconnect(o)}var u=this;a.forEachChild(n,null,function(t){var e,n;for(n=u.handlers,u.handlers=[],e=0;e<n.length;e++){var r=n[e];try{!r.isMatch(t)||!u.authenticated&&r.user?u.handlers.push(r):r.run(t)&&u.handlers.push(r)}catch(t){a.warn("Removing Strophe handlers due to uncaught exception: "+t.message)}}})}},mechanisms:{},_connect_cb:function(t,e,n){a.info("_connect_cb was called"),this.connected=!0;var r;try{r=this._proto._reqToData(t)}catch(t){if("badformat"!==t)throw t;this._changeConnectStatus(a.Status.CONNFAIL,"bad-format"),this._doDisconnect("bad-format")}if(r){this.xmlInput!==a.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==a.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(a.serialize(r)));if(this._proto._connect_cb(r)!==a.Status.CONNFAIL){if(!(r.getElementsByTagNameNS?r.getElementsByTagNameNS(a.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0))return void this._proto._no_auth_received(e);var i,o,s=[],c=r.getElementsByTagName("mechanism");if(c.length>0)for(i=0;i<c.length;i++)o=a.getText(c[i]),this.mechanisms[o]&&s.push(this.mechanisms[o]);if(0===s.length&&0===r.getElementsByTagName("auth").length)return void this._proto._no_auth_received(e);!1!==this.do_authentication&&this.authenticate(s)}}},sortMechanismsByPriority:function(t){var e,n,r,i;for(e=0;e<t.length-1;++e){for(r=e,n=e+1;n<t.length;++n)t[n].prototype.priority>t[r].prototype.priority&&(r=n);r!==e&&(i=t[e],t[e]=t[r],t[r]=i)}return t},_attemptSASLAuth:function(t){t=this.sortMechanismsByPriority(t||[]);var e=0,n=!1;for(e=0;e<t.length;++e)if(t[e].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new t[e],this._sasl_mechanism.onStart(this);var i=r("auth",{xmlns:a.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var o=this._sasl_mechanism.onChallenge(this,null);i.t(btoa(o))}this.send(i.tree()),n=!0;break}return n},_attemptLegacyAuth:function(){null===a.getNodeFromJid(this.jid)?(this._changeConnectStatus(a.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(a.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(o({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:a.NS.AUTH}).c("username",{}).t(a.getNodeFromJid(this.jid)).tree()))},authenticate:function(t){this._attemptSASLAuth(t)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(t){var e=atob(a.getText(t)),n=this._sasl_mechanism.onChallenge(this,e),i=r("response",{xmlns:a.NS.SASL});return""!==n&&i.t(btoa(n)),this.send(i.tree()),!0},_auth1_cb:function(t){var e=o({type:"set",id:"_auth_2"}).c("query",{xmlns:a.NS.AUTH}).c("username",{}).t(a.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return a.getResourceFromJid(this.jid)||(this.jid=a.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(a.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(t){if(this._sasl_data["server-signature"]){var e,n=atob(a.getText(t)),r=/([a-z]+)=([^,]+)(,|$)/,i=n.match(r);if("v"===i[1]&&(e=i[2]),e!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}a.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var o=[],s=function(t,e){for(;t.length;)this.deleteHandler(t.pop());return this._sasl_auth1_cb.bind(this)(e),!1};return o.push(this._addSysHandler(function(t){s.bind(this)(o,t)}.bind(this),null,"stream:features",null,null)),o.push(this._addSysHandler(function(t){s.bind(this)(o,t)}.bind(this),a.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(t){this.features=t;var e,n;for(e=0;e<t.childNodes.length;e++)n=t.childNodes[e],"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(a.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var r=a.getResourceFromJid(this.jid);return r?this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:a.NS.BIND}).c("resource",{}).t(r).tree()):this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:a.NS.BIND}).tree()),!1},_sasl_bind_cb:function(t){if("error"===t.getAttribute("type")){a.info("SASL binding failed.");var e,n=t.getElementsByTagName("conflict");return n.length>0&&(e="conflict"),this._changeConnectStatus(a.Status.AUTHFAIL,e),!1}var r,i=t.getElementsByTagName("bind");if(!(i.length>0))return a.info("SASL binding failed."),this._changeConnectStatus(a.Status.AUTHFAIL,null),!1;r=i[0].getElementsByTagName("jid"),r.length>0&&(this.jid=a.getText(r[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(o({type:"set",id:"_session_auth_2"}).c("session",{xmlns:a.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(a.Status.CONNECTED,null)))},_sasl_session_cb:function(t){if("result"===t.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(a.Status.CONNECTED,null);else if("error"===t.getAttribute("type"))return a.info("Session creation failed."),this._changeConnectStatus(a.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(t){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(a.Status.AUTHFAIL,null),!1},_auth2_cb:function(t){return"result"===t.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(a.Status.CONNECTED,null)):"error"===t.getAttribute("type")&&(this._changeConnectStatus(a.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(t,e){var n=new a.TimedHandler(t,e);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(t,e,n,r,i){var o=new a.Handler(t,e,n,r,i);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return a.info("_onDisconnectTimeout was called"),this._changeConnectStatus(a.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t,e,n,r;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)e=this.removeTimeds.pop(),(t=this.timedHandlers.indexOf(e))>=0&&this.timedHandlers.splice(t,1);var i=(new Date).getTime();for(r=[],t=0;t<this.timedHandlers.length;t++)e=this.timedHandlers[t],!this.authenticated&&e.user||(n=e.lastCalled+e.period,n-i<=0?e.run()&&r.push(e):r.push(e));this.timedHandlers=r,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}},a.SASLMechanism=function(t,e,n){this.name=t,this.isClientFirst=e,this.priority=n},a.SASLMechanism.prototype={test:function(t){return!0},onStart:function(t){this._connection=t},onChallenge:function(t,e){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},a.SASLAnonymous=function(){},a.SASLAnonymous.prototype=new a.SASLMechanism("ANONYMOUS",!1,20),a.SASLAnonymous.prototype.test=function(t){return null===t.authcid},a.SASLPlain=function(){},a.SASLPlain.prototype=new a.SASLMechanism("PLAIN",!0,30),a.SASLPlain.prototype.test=function(t){return null!==t.authcid},a.SASLPlain.prototype.onChallenge=function(t){var e=t.authzid;return e+="\0",e+=t.authcid,e+="\0",e+=t.pass,n.utf16to8(e)},a.SASLSHA1=function(){},a.SASLSHA1.prototype=new a.SASLMechanism("SCRAM-SHA-1",!0,50),a.SASLSHA1.prototype.test=function(t){return null!==t.authcid},a.SASLSHA1.prototype.onChallenge=function(r,i,o){var s=o||e.hexdigest(1234567890*Math.random()),a="n="+n.utf16to8(r.authcid);return a+=",r=",a+=s,r._sasl_data.cnonce=s,r._sasl_data["client-first-message-bare"]=a,a="n,,"+a,this.onChallenge=function(e,r){for(var i,o,s,a,c,u,l,h,d,p,f,_,m="c=biws,",g=e._sasl_data["client-first-message-bare"]+","+r+",",y=e._sasl_data.cnonce,v=/([a-z]+)=([^,]+)(,|$)/;r.match(v);){var b=r.match(v);switch(r=r.replace(b[0],""),b[1]){case"r":i=b[2];break;case"s":o=b[2];break;case"i":s=b[2]}}if(i.substr(0,y.length)!==y)return e._sasl_data={},e._sasl_failure_cb();for(m+="r="+i,g+=m,o=atob(o),o+="\0\0\0",d=n.utf16to8(e.pass),a=u=t.core_hmac_sha1(d,o),l=1;l<s;l++){for(c=t.core_hmac_sha1(d,t.binb2str(u)),h=0;h<5;h++)a[h]^=c[h];u=c}for(a=t.binb2str(a),p=t.core_hmac_sha1(a,"Client Key"),f=t.str_hmac_sha1(a,"Server Key"),_=t.core_hmac_sha1(t.str_sha1(t.binb2str(p)),g),e._sasl_data["server-signature"]=t.b64_hmac_sha1(f,g),h=0;h<5;h++)p[h]^=_[h];return m+=",p="+btoa(t.binb2str(p))}.bind(this),a},a.SASLMD5=function(){},a.SASLMD5.prototype=new a.SASLMechanism("DIGEST-MD5",!1,40),a.SASLMD5.prototype.test=function(t){return null!==t.authcid},a.SASLMD5.prototype._quote=function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},a.SASLMD5.prototype.onChallenge=function(t,r,i){for(var o,s=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,a=i||e.hexdigest(""+1234567890*Math.random()),c="",u=null,l="";r.match(s);)switch(o=r.match(s),r=r.replace(o[0],""),o[2]=o[2].replace(/^"(.+)"$/,"$1"),o[1]){case"realm":c=o[2];break;case"nonce":l=o[2];break;case"qop":o[2];break;case"host":u=o[2]}var h=t.servtype+"/"+t.domain;null!==u&&(h=h+"/"+u);var d=n.utf16to8(t.authcid+":"+c+":"+this._connection.pass),p=e.hash(d)+":"+l+":"+a,f="AUTHENTICATE:"+h,_="";return _+="charset=utf-8,",_+="username="+this._quote(n.utf16to8(t.authcid))+",",_+="realm="+this._quote(c)+",",_+="nonce="+this._quote(l)+",",_+="nc=00000001,",_+="cnonce="+this._quote(a)+",",_+="digest-uri="+this._quote(h)+",",_+="response="+e.hexdigest(e.hexdigest(p)+":"+l+":00000001:"+a+":auth:"+e.hexdigest(f))+",",_+="qop=auth",this.onChallenge=function(){return""},_},a.SASLOAuthBearer=function(){},a.SASLOAuthBearer.prototype=new a.SASLMechanism("OAUTHBEARER",!0,60),a.SASLOAuthBearer.prototype.test=function(t){return null!==t.pass},a.SASLOAuthBearer.prototype.onChallenge=function(t){var e="n,";return null!==t.authcid&&(e=e+"a="+t.authzid),e+=",",e+="",e+="auth=Bearer ",e+=t.pass,e+="",e+="",n.utf16to8(e)},a.SASLExternal=function(){},a.SASLExternal.prototype=new a.SASLMechanism("EXTERNAL",!0,10),a.SASLExternal.prototype.onChallenge=function(t){return t.authcid===t.authzid?"":t.authzid},{Strophe:a,$build:r,$iq:o,$msg:i,$pres:s,SHA1:t,MD5:e,b64_hmac_sha1:t.b64_hmac_sha1,b64_sha1:t.b64_sha1,str_hmac_sha1:t.str_hmac_sha1,str_sha1:t.str_sha1}}),function(t,e){if("function"!=typeof n||!n.amd)return e(Strophe,$build);n("strophe-bosh",["strophe-core"],function(t){return e(t.Strophe,t.$build)})}(0,function(t,e){return t.Request=function(e,n,r,i){this.id=++t._requestId,this.xmlData=e,this.data=t.serialize(e),this.origFunc=n,this.func=n,this.rid=r,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},t.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"===e.tagName)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),t.error("responseXML: "+t.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),"badformat";return e},_newXHR:function(){var t=null;return window.XMLHttpRequest?(t=new XMLHttpRequest,t.overrideMimeType&&t.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.onreadystatechange=this.func.bind(null,this),t}},t.Bosh=function(t){this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this._requests=[]},t.Bosh.prototype={strip:null,_buildBody:function(){var n=e("body",{rid:this.rid++,xmlns:t.NS.HTTPBIND});return null!==this.sid&&n.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),n},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,n,r){this.wait=e||this.wait,this.hold=n||this.hold,this.errors=0;var i=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":t.NS.BOSH});r&&i.attrs({route:r});var o=this._conn._connect_cb;this._requests.push(new t.Request(i.tree(),this._onRequestStateChange.bind(this,o.bind(this._conn)),i.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,n,r,i,o,s,a){this._conn.jid=e,this.sid=n,this.rid=r,this._conn.connect_callback=i,this._conn.domain=t.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=o||this.wait,this.hold=s||this.hold,this.window=a||this.window,this._conn._changeConnectStatus(t.Status.ATTACHED,null)},_restore:function(e,n,r,i,o){var s=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(void 0!==s&&null!==s&&s.rid&&s.sid&&s.jid&&(void 0===e||null===e||t.getBareJidFromJid(s.jid)===t.getBareJidFromJid(e)||null===t.getNodeFromJid(e)&&t.getDomainFromJid(s.jid)===e)))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(s.jid,s.sid,s.rid,n,r,i,o)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var n,r,i=e.getAttribute("type");if(null!==i&&"terminate"===i)return n=e.getAttribute("condition"),t.error("BOSH-Connection failed: "+n),r=e.getElementsByTagName("conflict"),null!==n?("remote-stream-error"===n&&r.length>0&&(n="conflict"),this._conn._changeConnectStatus(t.Status.CONNFAIL,n)):this._conn._changeConnectStatus(t.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),t.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var o=e.getAttribute("requests");o&&(this.window=parseInt(o,10));var s=e.getAttribute("hold");s&&(this.hold=parseInt(s,10));var a=e.getAttribute("wait");a&&(this.wait=parseInt(a,10));var c=e.getAttribute("inactivity");c&&(this.inactivity=parseInt(c,10))},_disconnect:function(t){this._sendTerminate(t)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(t){var e,n=this._getRequestStatus(t);(e=this._conn.protocolErrorHandlers.HTTP[n])&&e.call(this,n)},_hitError:function(e){this.errors++,t.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var n=this._buildBody();this._requests.push(new t.Request(n.tree(),this._onRequestStateChange.bind(this,e.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var t;this._requests.length>0;)t=this._requests.pop(),t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(t.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var n=this._buildBody(),r=0;r<e.length;r++)null!==e[r]&&("restart"===e[r]?n.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":t.NS.BOSH}):n.cnode(e[r]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new t.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var i=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),i>Math.floor(t.TIMEOUT*this.wait)&&(t.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(t.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,n){var r;if(4===e.xhr.readyState)try{r=e.xhr.status}catch(e){t.error("Caught an error while retrieving a request's status, reqStatus: "+r)}return void 0===r&&(r="number"==typeof n?n:0),r},_onRequestStateChange:function(e,n){if(t.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)return void(n.abort=!1);if(4===n.xhr.readyState){var r=this._getRequestStatus(n);if(this.disconnecting&&r>=400)return this._hitError(r),void this._callProtocolErrorHandlers(n);var i=r>0&&r<500,o=n.sends>this._conn.maxRetries;if((i||o)&&(this._removeRequest(n),t.debug("request id "+n.id+" should now be removed")),200===r){var s=this._requests[0]===n;(this._requests[1]===n||s&&this._requests.length>0&&this._requests[0].age()>Math.floor(t.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),t.debug("request id "+n.id+"."+n.sends+" got 200"),e(n),this.errors=0}else 0===r||r>=400&&r<600||r>=12e3?(t.error("request id "+n.id+"."+n.sends+" error "+r+" happened"),this._hitError(r),this._callProtocolErrorHandlers(n),r>=400&&r<500&&(this._conn._changeConnectStatus(t.Status.DISCONNECTING,null),this._conn._doDisconnect())):t.error("request id "+n.id+"."+n.sends+" error "+r+" happened");i||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(t.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var n=this,r=this._requests[e],i=this._getRequestStatus(r,-1);if(r.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var o=r.age(),s=!isNaN(o)&&o>Math.floor(t.TIMEOUT*this.wait),a=null!==r.dead&&r.timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait),c=4===r.xhr.readyState&&(i<1||i>=500);if((s||a||c)&&(a&&t.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),r.abort=!0,r.xhr.abort(),r.xhr.onreadystatechange=function(){},this._requests[e]=new t.Request(r.xmlData,r.origFunc,r.rid,r.sends),r=this._requests[e]),0===r.xhr.readyState){t.debug("request id "+r.id+"."+r.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";r.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==r.xhr.setRequestHeader&&r.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(r.xhr.withCredentials=!0)}catch(e){return t.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(t.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(r.date=new Date,n._conn.options.customHeaders){var t=n._conn.options.customHeaders;for(var e in t)t.hasOwnProperty(e)&&r.xhr.setRequestHeader(e,t[e])}r.xhr.send(r.data)};if(r.sends>1){var h=1e3*Math.min(Math.floor(t.TIMEOUT*this.wait),Math.pow(r.sends,3));setTimeout(function(){l()},h)}else l();r.sends++,this._conn.xmlOutput!==t.Connection.prototype.xmlOutput&&(r.xmlData.nodeName===this.strip&&r.xmlData.childNodes.length?this._conn.xmlOutput(r.xmlData.childNodes[0]):this._conn.xmlOutput(r.xmlData)),this._conn.rawOutput!==t.Connection.prototype.rawOutput&&this._conn.rawOutput(r.data)}else t.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+r.xhr.readyState)},_removeRequest:function(e){t.debug("removing request");var n;for(n=this._requests.length-1;n>=0;n--)e===this._requests[n]&&this._requests.splice(n,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(t){var e=this._requests[t];null===e.dead&&(e.dead=new Date),this._processRequest(t)},_reqToData:function(t){try{return t.getResponse()}catch(t){if("parsererror"!==t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){t.info("_sendTerminate was called");var n=this._buildBody().attrs({type:"terminate"});e&&n.cnode(e.tree());var r=new t.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"));this._requests.push(r),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?t.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):t.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},t}),function(t,e){if("function"!=typeof n||!n.amd)return e(Strophe,$build);n("strophe-websocket",["strophe-core"],function(t){return e(t.Strophe,t.$build)})}(0,function(t,e){return t.Websocket=function(t){this._conn=t,this.strip="wrapper";var e=t.service;if(0!==e.indexOf("ws:")&&0!==e.indexOf("wss:")){var n="";"ws"===t.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==e.indexOf("/")?n+=window.location.pathname+e:n+=e,t.service=n}},t.Websocket.prototype={_buildStream:function(){return e("open",{xmlns:t.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,n){var r;if(r=e.getElementsByTagNameNS?e.getElementsByTagNameNS(t.NS.STREAM,"error"):e.getElementsByTagName("stream:error"),0===r.length)return!1;for(var i=r[0],o="",s="",a=0;a<i.childNodes.length;a++){var c=i.childNodes[a];if("urn:ietf:params:xml:ns:xmpp-streams"!==c.getAttribute("xmlns"))break;"text"===c.nodeName?s=c.textContent:o=c.nodeName}var u="WebSocket stream error: ";return u+=o||"unknown",s&&(u+=" - "+s),t.error(u),this._conn._changeConnectStatus(n,o),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){if(this._check_streamerror(e,t.Status.CONNFAIL))return t.Status.CONNFAIL},_handleStreamStart:function(e){var n=!1,r=e.getAttribute("xmlns");"string"!=typeof r?n="Missing xmlns in <open />":r!==t.NS.FRAMING&&(n="Wrong xmlns in <open />: "+r);var i=e.getAttribute("version");return"string"!=typeof i?n="Missing version in <open />":"1.0"!==i&&(n="Wrong version in <open />: "+i),!n||(this._conn._changeConnectStatus(t.Status.CONNFAIL,n),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var n=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===n)return;var r=(new DOMParser).parseFromString(n,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(e.data),this._handleStreamStart(r)&&this._connect_cb(r)}else if(0===e.data.indexOf("<close ")){this._conn.rawInput(e.data),this._conn.xmlInput(e);var i=e.getAttribute("see-other-uri");i?(this._conn._changeConnectStatus(t.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=i,this._connect()):(this._conn._changeConnectStatus(t.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var o=this._streamWrap(e.data),s=(new DOMParser).parseFromString(o,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(s,null,e.data)}},_disconnect:function(n){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){n&&this._conn.send(n);var r=e("close",{xmlns:t.NS.FRAMING});this._conn.xmlOutput(r);var i=t.serialize(r);this._conn.rawOutput(i);try{this.socket.send(i)}catch(e){t.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){t.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(t){return"<wrapper>"+t+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(t){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(t.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(t.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):t.info("Websocket closed")},_no_auth_received:function(e){t.error("Server did not send any auth methods"),this._conn._changeConnectStatus(t.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=e.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){t.error("Websocket error "+e),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var n=0;n<e.length;n++)if(null!==e[n]){var r,i;r="restart"===e[n]?this._buildStream().tree():e[n],i=t.serialize(r),this._conn.xmlOutput(r),
this._conn.rawOutput(i),this.socket.send(i)}this._conn._data=[]}},_onMessage:function(e){var n,r,i='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===i)return this._conn.rawInput(i),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(n=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(n))return}else r=this._streamWrap(e.data),n=(new DOMParser).parseFromString(r,"text/xml").documentElement;return this._check_streamerror(n,t.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===n.firstChild.nodeName&&"unavailable"===n.firstChild.getAttribute("type")?(this._conn.xmlInput(n),void this._conn.rawInput(t.serialize(n))):void this._conn._dataRecv(n,e.data)},_onOpen:function(){t.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var n=t.serialize(e);this._conn.rawOutput(n),this.socket.send(n)},_reqToData:function(t){return t},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},t}),function(t){"function"==typeof n&&n.amd&&n("strophe",["strophe-core","strophe-bosh","strophe-websocket"],function(t){return t})}(),e(["strophe-polyfill"]),e("strophe")})},function(t,e,n){var r,i;(function(){function n(t){function e(e,n,r,i,o,s){for(;o>=0&&o<s;o+=t){var a=i?i[o]:o;r=n(r,e[a],a,e)}return r}return function(n,r,i,o){r=S(r,o,4);var s=!A(n)&&E.keys(n),a=(s||n).length,c=t>0?0:a-1;return arguments.length<3&&(i=n[s?s[c]:c],c+=t),e(n,r,i,s,c,a)}}function o(t){return function(e,n,r){n=T(n,r);for(var i=R(e),o=t>0?0:i-1;o>=0&&o<i;o+=t)if(n(e[o],o,e))return o;return-1}}function s(t,e,n){return function(r,i,o){var s=0,a=R(r);if("number"==typeof o)t>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(n&&o&&a)return o=n(r,i),r[o]===i?o:-1;if(i!==i)return o=e(f.call(r,s,a),E.isNaN),o>=0?o+s:-1;for(o=t>0?s:a-1;o>=0&&o<a;o+=t)if(r[o]===i)return o;return-1}}function a(t,e){var n=D.length,r=t.constructor,i=E.isFunction(r)&&r.prototype||h,o="constructor";for(E.has(t,o)&&!E.contains(e,o)&&e.push(o);n--;)(o=D[n])in t&&t[o]!==i[o]&&!E.contains(e,o)&&e.push(o)}var c=this,u=c._,l=Array.prototype,h=Object.prototype,d=Function.prototype,p=l.push,f=l.slice,_=h.toString,m=h.hasOwnProperty,g=Array.isArray,y=Object.keys,v=d.bind,b=Object.create,N=function(){},E=function t(e){return e instanceof t?e:this instanceof t?void(this._wrapped=e):new t(e)};void 0!==t&&t.exports&&(e=t.exports=E),e._=E,E.VERSION="1.8.3";var S=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)}}return function(){return t.apply(e,arguments)}},T=function(t,e,n){return null==t?E.identity:E.isFunction(t)?S(t,e,n):E.isObject(t)?E.matcher(t):E.property(t)};E.iteratee=function(t,e){return T(t,e,1/0)};var x=function(t,e){return function(n){var r=arguments.length;if(r<2||null==n)return n;for(var i=1;i<r;i++)for(var o=arguments[i],s=t(o),a=s.length,c=0;c<a;c++){var u=s[c];e&&void 0!==n[u]||(n[u]=o[u])}return n}},O=function(t){if(!E.isObject(t))return{};if(b)return b(t);N.prototype=t;var e=new N;return N.prototype=null,e},I=function(t){return function(e){return null==e?void 0:e[t]}},C=Math.pow(2,53)-1,R=I("length"),A=function(t){var e=R(t);return"number"==typeof e&&e>=0&&e<=C};E.each=E.forEach=function(t,e,n){e=S(e,n);var r,i;if(A(t))for(r=0,i=t.length;r<i;r++)e(t[r],r,t);else{var o=E.keys(t);for(r=0,i=o.length;r<i;r++)e(t[o[r]],o[r],t)}return t},E.map=E.collect=function(t,e,n){e=T(e,n);for(var r=!A(t)&&E.keys(t),i=(r||t).length,o=Array(i),s=0;s<i;s++){var a=r?r[s]:s;o[s]=e(t[a],a,t)}return o},E.reduce=E.foldl=E.inject=n(1),E.reduceRight=E.foldr=n(-1),E.find=E.detect=function(t,e,n){var r;if(void 0!==(r=A(t)?E.findIndex(t,e,n):E.findKey(t,e,n))&&-1!==r)return t[r]},E.filter=E.select=function(t,e,n){var r=[];return e=T(e,n),E.each(t,function(t,n,i){e(t,n,i)&&r.push(t)}),r},E.reject=function(t,e,n){return E.filter(t,E.negate(T(e)),n)},E.every=E.all=function(t,e,n){e=T(e,n);for(var r=!A(t)&&E.keys(t),i=(r||t).length,o=0;o<i;o++){var s=r?r[o]:o;if(!e(t[s],s,t))return!1}return!0},E.some=E.any=function(t,e,n){e=T(e,n);for(var r=!A(t)&&E.keys(t),i=(r||t).length,o=0;o<i;o++){var s=r?r[o]:o;if(e(t[s],s,t))return!0}return!1},E.contains=E.includes=E.include=function(t,e,n,r){return A(t)||(t=E.values(t)),("number"!=typeof n||r)&&(n=0),E.indexOf(t,e,n)>=0},E.invoke=function(t,e){var n=f.call(arguments,2),r=E.isFunction(e);return E.map(t,function(t){var i=r?e:t[e];return null==i?i:i.apply(t,n)})},E.pluck=function(t,e){return E.map(t,E.property(e))},E.where=function(t,e){return E.filter(t,E.matcher(e))},E.findWhere=function(t,e){return E.find(t,E.matcher(e))},E.max=function(t,e,n){var r,i,o=-1/0,s=-1/0;if(null==e&&null!=t){t=A(t)?t:E.values(t);for(var a=0,c=t.length;a<c;a++)(r=t[a])>o&&(o=r)}else e=T(e,n),E.each(t,function(t,n,r){((i=e(t,n,r))>s||i===-1/0&&o===-1/0)&&(o=t,s=i)});return o},E.min=function(t,e,n){var r,i,o=1/0,s=1/0;if(null==e&&null!=t){t=A(t)?t:E.values(t);for(var a=0,c=t.length;a<c;a++)(r=t[a])<o&&(o=r)}else e=T(e,n),E.each(t,function(t,n,r){((i=e(t,n,r))<s||i===1/0&&o===1/0)&&(o=t,s=i)});return o},E.shuffle=function(t){for(var e,n=A(t)?t:E.values(t),r=n.length,i=Array(r),o=0;o<r;o++)e=E.random(0,o),e!==o&&(i[o]=i[e]),i[e]=n[o];return i},E.sample=function(t,e,n){return null==e||n?(A(t)||(t=E.values(t)),t[E.random(t.length-1)]):E.shuffle(t).slice(0,Math.max(0,e))},E.sortBy=function(t,e,n){return e=T(e,n),E.pluck(E.map(t,function(t,n,r){return{value:t,index:n,criteria:e(t,n,r)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index}),"value")};var M=function(t){return function(e,n,r){var i={};return n=T(n,r),E.each(e,function(r,o){var s=n(r,o,e);t(i,r,s)}),i}};E.groupBy=M(function(t,e,n){E.has(t,n)?t[n].push(e):t[n]=[e]}),E.indexBy=M(function(t,e,n){t[n]=e}),E.countBy=M(function(t,e,n){E.has(t,n)?t[n]++:t[n]=1}),E.toArray=function(t){return t?E.isArray(t)?f.call(t):A(t)?E.map(t,E.identity):E.values(t):[]},E.size=function(t){return null==t?0:A(t)?t.length:E.keys(t).length},E.partition=function(t,e,n){e=T(e,n);var r=[],i=[];return E.each(t,function(t,n,o){(e(t,n,o)?r:i).push(t)}),[r,i]},E.first=E.head=E.take=function(t,e,n){if(null!=t)return null==e||n?t[0]:E.initial(t,t.length-e)},E.initial=function(t,e,n){return f.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},E.last=function(t,e,n){if(null!=t)return null==e||n?t[t.length-1]:E.rest(t,Math.max(0,t.length-e))},E.rest=E.tail=E.drop=function(t,e,n){return f.call(t,null==e||n?1:e)},E.compact=function(t){return E.filter(t,E.identity)};var w=function t(e,n,r,i){for(var o=[],s=0,a=i||0,c=R(e);a<c;a++){var u=e[a];if(A(u)&&(E.isArray(u)||E.isArguments(u))){n||(u=t(u,n,r));var l=0,h=u.length;for(o.length+=h;l<h;)o[s++]=u[l++]}else r||(o[s++]=u)}return o};E.flatten=function(t,e){return w(t,e,!1)},E.without=function(t){return E.difference(t,f.call(arguments,1))},E.uniq=E.unique=function(t,e,n,r){E.isBoolean(e)||(r=n,n=e,e=!1),null!=n&&(n=T(n,r));for(var i=[],o=[],s=0,a=R(t);s<a;s++){var c=t[s],u=n?n(c,s,t):c;e?(s&&o===u||i.push(c),o=u):n?E.contains(o,u)||(o.push(u),i.push(c)):E.contains(i,c)||i.push(c)}return i},E.union=function(){return E.uniq(w(arguments,!0,!0))},E.intersection=function(t){for(var e=[],n=arguments.length,r=0,i=R(t);r<i;r++){var o=t[r];if(!E.contains(e,o)){for(var s=1;s<n&&E.contains(arguments[s],o);s++);s===n&&e.push(o)}}return e},E.difference=function(t){var e=w(arguments,!0,!0,1);return E.filter(t,function(t){return!E.contains(e,t)})},E.zip=function(){return E.unzip(arguments)},E.unzip=function(t){for(var e=t&&E.max(t,R).length||0,n=Array(e),r=0;r<e;r++)n[r]=E.pluck(t,r);return n},E.object=function(t,e){for(var n={},r=0,i=R(t);r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},E.findIndex=o(1),E.findLastIndex=o(-1),E.sortedIndex=function(t,e,n,r){n=T(n,r,1);for(var i=n(e),o=0,s=R(t);o<s;){var a=Math.floor((o+s)/2);n(t[a])<i?o=a+1:s=a}return o},E.indexOf=s(1,E.findIndex,E.sortedIndex),E.lastIndexOf=s(-1,E.findLastIndex),E.range=function(t,e,n){null==e&&(e=t||0,t=0),n=n||1;for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),o=0;o<r;o++,t+=n)i[o]=t;return i};var B=function(t,e,n,r,i){if(!(r instanceof e))return t.apply(n,i);var o=O(t.prototype),s=t.apply(o,i);return E.isObject(s)?s:o};E.bind=function(t,e){if(v&&t.bind===v)return v.apply(t,f.call(arguments,1));if(!E.isFunction(t))throw new TypeError("Bind must be called on a function");var n=f.call(arguments,2);return function r(){return B(t,r,e,this,n.concat(f.call(arguments)))}},E.partial=function(t){var e=f.call(arguments,1);return function n(){for(var r=0,i=e.length,o=Array(i),s=0;s<i;s++)o[s]=e[s]===E?arguments[r++]:e[s];for(;r<arguments.length;)o.push(arguments[r++]);return B(t,n,this,this,o)}},E.bindAll=function(t){var e,n,r=arguments.length;if(r<=1)throw new Error("bindAll must be passed function names");for(e=1;e<r;e++)n=arguments[e],t[n]=E.bind(t[n],t);return t},E.memoize=function(t,e){var n=function n(r){var i=n.cache,o=""+(e?e.apply(this,arguments):r);return E.has(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return n.cache={},n},E.delay=function(t,e){var n=f.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},E.defer=E.partial(E.delay,E,1),E.throttle=function(t,e,n){var r,i,o,s=null,a=0;n||(n={});var c=function(){a=!1===n.leading?0:E.now(),s=null,o=t.apply(r,i),s||(r=i=null)};return function(){var u=E.now();a||!1!==n.leading||(a=u);var l=e-(u-a);return r=this,i=arguments,l<=0||l>e?(s&&(clearTimeout(s),s=null),a=u,o=t.apply(r,i),s||(r=i=null)):s||!1===n.trailing||(s=setTimeout(c,l)),o}},E.debounce=function(t,e,n){var r,i,o,s,a,c=function c(){var u=E.now()-s;u<e&&u>=0?r=setTimeout(c,e-u):(r=null,n||(a=t.apply(o,i),r||(o=i=null)))};return function(){o=this,i=arguments,s=E.now();var u=n&&!r;return r||(r=setTimeout(c,e)),u&&(a=t.apply(o,i),o=i=null),a}},E.wrap=function(t,e){return E.partial(e,t)},E.negate=function(t){return function(){return!t.apply(this,arguments)}},E.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}},E.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},E.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},E.once=E.partial(E.before,2);var k=!{toString:null}.propertyIsEnumerable("toString"),D=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];E.keys=function(t){if(!E.isObject(t))return[];if(y)return y(t);var e=[];for(var n in t)E.has(t,n)&&e.push(n);return k&&a(t,e),e},E.allKeys=function(t){if(!E.isObject(t))return[];var e=[];for(var n in t)e.push(n);return k&&a(t,e),e},E.values=function(t){for(var e=E.keys(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r},E.mapObject=function(t,e,n){e=T(e,n);for(var r,i=E.keys(t),o=i.length,s={},a=0;a<o;a++)r=i[a],s[r]=e(t[r],r,t);return s},E.pairs=function(t){for(var e=E.keys(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=[e[i],t[e[i]]];return r},E.invert=function(t){for(var e={},n=E.keys(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e},E.functions=E.methods=function(t){var e=[];for(var n in t)E.isFunction(t[n])&&e.push(n);return e.sort()},E.extend=x(E.allKeys),E.extendOwn=E.assign=x(E.keys),E.findKey=function(t,e,n){e=T(e,n);for(var r,i=E.keys(t),o=0,s=i.length;o<s;o++)if(r=i[o],e(t[r],r,t))return r},E.pick=function(t,e,n){var r,i,o={},s=t;if(null==s)return o;E.isFunction(e)?(i=E.allKeys(s),r=S(e,n)):(i=w(arguments,!1,!1,1),r=function(t,e,n){return e in n},s=Object(s));for(var a=0,c=i.length;a<c;a++){var u=i[a],l=s[u];r(l,u,s)&&(o[u]=l)}return o},E.omit=function(t,e,n){if(E.isFunction(e))e=E.negate(e);else{var r=E.map(w(arguments,!1,!1,1),String);e=function(t,e){return!E.contains(r,e)}}return E.pick(t,e,n)},E.defaults=x(E.allKeys,!0),E.create=function(t,e){var n=O(t);return e&&E.extendOwn(n,e),n},E.clone=function(t){return E.isObject(t)?E.isArray(t)?t.slice():E.extend({},t):t},E.tap=function(t,e){return e(t),t},E.isMatch=function(t,e){var n=E.keys(e),r=n.length;if(null==t)return!r;for(var i=Object(t),o=0;o<r;o++){var s=n[o];if(e[s]!==i[s]||!(s in i))return!1}return!0};var j=function t(e,n,r,i){if(e===n)return 0!==e||1/e==1/n;if(null==e||null==n)return e===n;e instanceof E&&(e=e._wrapped),n instanceof E&&(n=n._wrapped);var o=_.call(e);if(o!==_.call(n))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+e==""+n;case"[object Number]":return+e!=+e?+n!=+n:0==+e?1/+e==1/n:+e==+n;case"[object Date]":case"[object Boolean]":return+e==+n}var s="[object Array]"===o;if(!s){if("object"!=(void 0===e?"undefined":_typeof(e))||"object"!=(void 0===n?"undefined":_typeof(n)))return!1;var a=e.constructor,c=n.constructor;if(a!==c&&!(E.isFunction(a)&&a instanceof a&&E.isFunction(c)&&c instanceof c)&&"constructor"in e&&"constructor"in n)return!1}r=r||[],i=i||[];for(var u=r.length;u--;)if(r[u]===e)return i[u]===n;if(r.push(e),i.push(n),s){if((u=e.length)!==n.length)return!1;for(;u--;)if(!t(e[u],n[u],r,i))return!1}else{var l,h=E.keys(e);if(u=h.length,E.keys(n).length!==u)return!1;for(;u--;)if(l=h[u],!E.has(n,l)||!t(e[l],n[l],r,i))return!1}return r.pop(),i.pop(),!0};E.isEqual=function(t,e){return j(t,e)},E.isEmpty=function(t){return null==t||(A(t)&&(E.isArray(t)||E.isString(t)||E.isArguments(t))?0===t.length:0===E.keys(t).length)},E.isElement=function(t){return!(!t||1!==t.nodeType)},E.isArray=g||function(t){return"[object Array]"===_.call(t)},E.isObject=function(t){var e=void 0===t?"undefined":_typeof(t);return"function"===e||"object"===e&&!!t},E.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){E["is"+t]=function(e){return _.call(e)==="[object "+t+"]"}}),E.isArguments(arguments)||(E.isArguments=function(t){return E.has(t,"callee")}),"function"!=typeof/./&&"object"!=("undefined"==typeof Int8Array?"undefined":_typeof(Int8Array))&&(E.isFunction=function(t){return"function"==typeof t||!1}),E.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},E.isNaN=function(t){return E.isNumber(t)&&t!==+t},E.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===_.call(t)},E.isNull=function(t){return null===t},E.isUndefined=function(t){return void 0===t},E.has=function(t,e){return null!=t&&m.call(t,e)},E.noConflict=function(){return c._=u,this},E.identity=function(t){return t},E.constant=function(t){return function(){return t}},E.noop=function(){},E.property=I,E.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},E.matcher=E.matches=function(t){return t=E.extendOwn({},t),function(e){return E.isMatch(e,t)}},E.times=function(t,e,n){var r=Array(Math.max(0,t));e=S(e,n,1);for(var i=0;i<t;i++)r[i]=e(i);return r},E.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},E.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},L=E.invert(H),F=function(t){var e=function(e){return t[e]},n="(?:"+E.keys(t).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,e):t}};E.escape=F(H),E.unescape=F(L),E.result=function(t,e,n){var r=null==t?void 0:t[e];return void 0===r&&(r=n),E.isFunction(r)?r.call(t):r};var U=0;E.uniqueId=function(t){var e=++U+"";return t?t+e:e},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var W=/(.)^/,q={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},G=/\\|'|\r|\n|\u2028|\u2029/g,P=function(t){return"\\"+q[t]};E.template=function(t,e,n){!e&&n&&(e=n),e=E.defaults({},e,E.templateSettings);var r=RegExp([(e.escape||W).source,(e.interpolate||W).source,(e.evaluate||W).source].join("|")+"|$","g"),i=0,o="__p+='";t.replace(r,function(e,n,r,s,a){return o+=t.slice(i,a).replace(G,P),i=a+e.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),e}),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(e.variable||"obj","_",o)}catch(t){throw t.source=o,t}var a=function(t){return s.call(this,t,E)};return a.source="function("+(e.variable||"obj")+"){\n"+o+"}",a},E.chain=function(t){var e=E(t);return e._chain=!0,e};var J=function(t,e){return t._chain?E(e).chain():e};E.mixin=function(t){E.each(E.functions(t),function(e){var n=E[e]=t[e];E.prototype[e]=function(){var t=[this._wrapped];return p.apply(t,arguments),J(this,n.apply(E,t))}})},E.mixin(E),E.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=l[t];E.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],J(this,n)}}),E.each(["concat","join","slice"],function(t){var e=l[t];E.prototype[t]=function(){return J(this,e.apply(this._wrapped,arguments))}}),E.prototype.value=function(){return this._wrapped},E.prototype.valueOf=E.prototype.toJSON=E.prototype.value,E.prototype.toString=function(){return""+this._wrapped},r=[],void 0!==(i=function(){return E}.apply(e,r))&&(t.exports=i)}).call(this)}])});
//# sourceMappingURL=websdk-1.4.12.min.js.map
